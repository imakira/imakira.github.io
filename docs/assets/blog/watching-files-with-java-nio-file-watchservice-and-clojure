{"blog/orgx":false,"blog/tags":[],"blog/unlisted":false,"blog/title":"Watching Files with java.nio.file.WatchService and Clojure","blog/show-toc?":true,"blog/file-path":"/home/void/Projects/imakira.github.io/blogs/watching-files-with-java.nio.file.WatchService-and-clojure.org","blog/author":null,"blog/email":null,"blog/description":"Recently I want to have a utility in Clojure that can notify me when there is a change happened in some specified directory. Fortunately Java seems to nati...","blog/id":"watching-files-with-java-nio-file-watchservice-and-clojure","blog/category":"Coding","blog/language":"en_US","blog/published-date":"2025-12-13T22:18:29+08:00","blog/content":"<p>\nRecently I want to have a utility in Clojure that can notify me when there is a change happened in some specified directory. Fortunately Java seems to natively support it by providing a <code>java.nio.file.WatchService</code>. It seems trivial so I want to use it directly in Clojure instead of adding another dependency to my project. It turns out to be sightly more complicated than I expected. Let me explain.\n</p>\n<div id=\"outline-container-the-problem\" class=\"outline-2\">\n<a href=\"#the-problem\"><h2 id=\"the-problem\" class=\"cr-self-reference \">The Problem</h2></a>\n<div class=\"outline-text-2\" id=\"text-the-problem\">\n<p>\nThe challenge mainly lies in the fact that, Java doesn't natively support recursively watching a directory. If we want this behavoir, we have to implement it ourselves.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-keyword\">def</span> ^<span class=\"hljs-symbol\">:dynamic</span> <span class=\"hljs-title\">*chan-size*</span> <span class=\"hljs-number\">512</span>)\n\n(<span class=\"hljs-keyword\">defn</span> <span class=\"hljs-title\">register</span> [^Path path ^WatchService watch-service]\n  (<span class=\"hljs-name\">.register</span> path\n             watch-service\n             (<span class=\"hljs-name\"><span class=\"hljs-built_in\">into-array</span></span> WatchEvent$Kind\n                         [StandardWatchEventKinds/ENTRY_CREATE\n                          StandardWatchEventKinds/ENTRY_DELETE\n                          StandardWatchEventKinds/ENTRY_MODIFY\n                          StandardWatchEventKinds/OVERFLOW])))\n\n(<span class=\"hljs-keyword\">defn</span> <span class=\"hljs-title\">watch</span> [&amp; paths]\n  (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [resp-chan (<span class=\"hljs-name\">a/chan</span> *chan-size*)\n        cancel-chan (<span class=\"hljs-name\">a/chan</span> <span class=\"hljs-number\">1</span>)\n        stopped? (<span class=\"hljs-name\"><span class=\"hljs-built_in\">atom</span></span> <span class=\"hljs-literal\">false</span>)\n\n        worker\n        (<span class=\"hljs-name\"><span class=\"hljs-built_in\">future</span></span>\n          (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [paths (<span class=\"hljs-name\"><span class=\"hljs-built_in\">map</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">fn</span></span> [p]\n                             (<span class=\"hljs-name\">Path/of</span> p (<span class=\"hljs-name\"><span class=\"hljs-built_in\">into-array</span></span> String [])))\n                           paths)\n                watch-service (<span class=\"hljs-name\"><span class=\"hljs-built_in\">-&gt;</span></span> (<span class=\"hljs-name\">java.nio.file.FileSystems/getDefault</span>)\n                                  (<span class=\"hljs-name\">.newWatchService</span>))]\n            (<span class=\"hljs-name\"><span class=\"hljs-built_in\">doseq</span></span> [path paths]\n              (<span class=\"hljs-name\"><span class=\"hljs-built_in\">doseq</span></span> [^File subpath-file (<span class=\"hljs-name\">file-seq</span> (<span class=\"hljs-name\">.toFile</span> path))]\n                (<span class=\"hljs-name\"><span class=\"hljs-built_in\">when</span></span> (<span class=\"hljs-name\">.isDirectory</span> subpath-file)\n                  (<span class=\"hljs-name\">register</span> (<span class=\"hljs-name\">.toPath</span> subpath-file)\n                            watch-service))))\n            (<span class=\"hljs-name\"><span class=\"hljs-built_in\">try</span></span>\n              (<span class=\"hljs-name\"><span class=\"hljs-built_in\">while</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">not</span></span> @stopped?)\n                (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [watch-key (<span class=\"hljs-name\">.take</span> watch-service)\n                      events (<span class=\"hljs-name\">.pollEvents</span> watch-key)\n                      ^Path parent-dir (<span class=\"hljs-name\">.watchable</span> watch-key)]\n                  (<span class=\"hljs-name\"><span class=\"hljs-built_in\">doseq</span></span> [^WatchEvent event events]\n                    (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [^WatchEvent$Kind kind (<span class=\"hljs-name\">.kind</span> event)\n                          ^Path event-path (<span class=\"hljs-name\">.context</span> event)\n                          ^Path resolved-path (<span class=\"hljs-name\">.resolve</span> parent-dir event-path)]\n                      (<span class=\"hljs-name\">a/&gt;!!</span> resp-chan\n                             {<span class=\"hljs-symbol\">:kind</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">case</span></span> (<span class=\"hljs-name\">.name</span> kind)\n                                      <span class=\"hljs-string\">&quot;ENTRY_CREATE&quot;</span> <span class=\"hljs-symbol\">:entry-create</span>\n                                      <span class=\"hljs-string\">&quot;ENTRY_MODIFY&quot;</span> <span class=\"hljs-symbol\">:entry-modify</span>\n                                      <span class=\"hljs-string\">&quot;ENTRY_DELETE&quot;</span> <span class=\"hljs-symbol\">:entry-delete</span>\n                                      <span class=\"hljs-string\">&quot;OVERFLOW&quot;</span> <span class=\"hljs-symbol\">:overflow</span>)\n                              <span class=\"hljs-symbol\">:path</span> resolved-path})\n\n                      <span class=\"hljs-comment\">;; If the newly created object is a directory,</span>\n                      <span class=\"hljs-comment\">;;   we recursively register files in it.</span>\n                          (<span class=\"hljs-name\"><span class=\"hljs-built_in\">when</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">and</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">=</span></span> kind StandardWatchEventKinds/ENTRY_CREATE)\n                                 (<span class=\"hljs-name\">.isDirectory</span> (<span class=\"hljs-name\">.toFile</span> resolved-path)))\n                        (<span class=\"hljs-name\"><span class=\"hljs-built_in\">doseq</span></span> [^File subpath-file (<span class=\"hljs-name\">file-seq</span> (<span class=\"hljs-name\">.toFile</span> resolved-path))]\n                          (<span class=\"hljs-name\"><span class=\"hljs-built_in\">when</span></span> (<span class=\"hljs-name\">.isDirectory</span> subpath-file)\n                            (<span class=\"hljs-name\">register</span> (<span class=\"hljs-name\">.toPath</span> subpath-file)\n                                      watch-service))))\n                      (<span class=\"hljs-name\">.reset</span> watch-key)))))\n              (<span class=\"hljs-name\">catch</span> InterruptedException _)\n              (<span class=\"hljs-name\">finally</span>\n                (<span class=\"hljs-name\">.close</span> watch-service)))))\n\n        sentinel (<span class=\"hljs-name\"><span class=\"hljs-built_in\">future</span></span>\n                   (<span class=\"hljs-name\"><span class=\"hljs-built_in\">while</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">not</span></span> (<span class=\"hljs-name\">a/&lt;!!</span> cancel-chan)))\n                   (<span class=\"hljs-name\"><span class=\"hljs-built_in\">reset!</span></span> stopped? <span class=\"hljs-literal\">true</span>)\n                   (<span class=\"hljs-name\">future-cancel</span> worker)\n                   (<span class=\"hljs-name\">a/close!</span> resp-chan)\n                   (<span class=\"hljs-name\">a/close!</span> cancel-chan))]\n    (<span class=\"hljs-name\"><span class=\"hljs-built_in\">with-meta</span></span> [resp-chan cancel-chan]\n      {<span class=\"hljs-symbol\">:debug</span> {<span class=\"hljs-symbol\">:worker</span> worker\n               <span class=\"hljs-symbol\">:sentinel</span> sentinel\n               <span class=\"hljs-symbol\">:stopped?</span> stopped?}})))\n</body></html></code></pre>\n</div>\n\n<p>\nThe initial implementation looks like this, which is fairly straightforward. We start by recursively registering files in the directories provided by <code>paths</code> argument, and if there is a newly created directory, we also recursively register its contents. Clojure provides a <code>file-seq</code> function that makes this task much easier. For an example usage of this code, check the end of this post.\n</p>\n\n<p>\nHowever, there is only one issue: If a file is created in a subdirectory before the subdirectory got registered, the event won't be fired.\n</p>\n\n<pre class=\"example\" id=\"org9164fac\">+---------------+\n| worker thread |\n+-------+-------+\n        +                 +---------------+\n        +-----------------| create subdir |\n        |                 +---------------+\n+-------+---------------+\n| event: subdir created |\n+-------+---------------+    \n        |                 +------------------------+\n        +-----------------+ new file in the subdir |\n        |                 +------------------------+\n+-------+-----------+\n| subdir registered |\n+-------------------+\n</pre>\n</div>\n</div>\n<div id=\"outline-container-the-workaround\" class=\"outline-2\">\n<a href=\"#the-workaround\"><h2 id=\"the-workaround\" class=\"cr-self-reference \">The Workaround</h2></a>\n<div class=\"outline-text-2\" id=\"text-the-workaround\">\n<p>\nWe can have a workaround of this by emitting an event of each file in the newly created directory, like this:\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-name\"><span class=\"hljs-built_in\">when</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">and</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">=</span></span> kind StandardWatchEventKinds/ENTRY_CREATE)\n           (<span class=\"hljs-name\">.isDirectory</span> (<span class=\"hljs-name\">.toFile</span> resolved-path)))\n\n  (<span class=\"hljs-name\">register</span> resolved-path\n            watch-service)\n\n  (<span class=\"hljs-name\"><span class=\"hljs-built_in\">doseq</span></span> [^File subpath-file (<span class=\"hljs-name\"><span class=\"hljs-built_in\">rest</span></span> (<span class=\"hljs-name\">file-seq</span> (<span class=\"hljs-name\">.toFile</span> resolved-path)))]\n    (<span class=\"hljs-name\"><span class=\"hljs-built_in\">when</span></span> (<span class=\"hljs-name\">.isDirectory</span> subpath-file)\n      (<span class=\"hljs-name\">register</span> (<span class=\"hljs-name\">.toPath</span> subpath-file)\n                watch-service))\n    (<span class=\"hljs-name\">a/&gt;!!</span> resp-chan\n           {<span class=\"hljs-symbol\">:kind</span> <span class=\"hljs-symbol\">:entry-create</span>\n            <span class=\"hljs-symbol\">:path</span> (<span class=\"hljs-name\">.toPath</span> subpath-file)})))\n</body></html></code></pre>\n</div>\n\n<p>\nHowever, it introduces a new problem. If a file is created in a subdirectory after be subdirectory is regsitered, but before the subdirectories scanning is finished. The event of the file may be emitted twice.\n</p>\n\n<pre class=\"example\" id=\"orgb53adab\">  +---------------+\n  | worker thread |\n  +-------+-------+\n          +                +----------------+\n          +----------------+ subdir created |\n          |                +----------------+\n          |\n +--------+----------+\n | subdir registered |\n +--------+----------+\n          |              +-------------------------+\n          |--------------+ file1 created in subdir |\n          |              +-------------------------+\n +--------+---------+\n | scan: find file1 |\n +--------+---------+  \n          |               \n          |               \n+---------+------------+ \n| event: file1 created |\n+----------------------+      \n</pre>\n\n<p>\nWe have three choices here, we can:\n</p>\n\n<ul class=\"org-ul\">\n<li>ignore this issue, treat it as something acceptable.</li>\n<li>discard the workaround all together, let the user scan if there is any new file in the newly created directory.</li>\n<li>memorize all the files detected, check if the event has already been fired if a new file is detected.</li>\n</ul>\n\n<p>\nIn my case, the first option is good enough, however, it got me curious about how this issue is handled by other projects.\n</p>\n</div>\n</div>\n<div id=\"outline-container-how-is-it-handled-by-other-projects?\" class=\"outline-2\">\n<a href=\"#how-is-it-handled-by-other-projects?\"><h2 id=\"how-is-it-handled-by-other-projects?\" class=\"cr-self-reference \">How is it Handled by Other Projects?</h2></a>\n<div class=\"outline-text-2\" id=\"text-how-is-it-handled-by-other-projects?\">\n</div>\n<div id=\"outline-container-chokidar\" class=\"outline-3\">\n<a href=\"#chokidar\"><h3 id=\"chokidar\" class=\"cr-self-reference \">chokidar</h3></a>\n<div class=\"outline-text-3\" id=\"text-chokidar\">\n<p>\n<a href=\"https://github.com/paulmillr/chokidar\">chokidar</a> is a famous file watching library in JavaScript. It seems to have chosen the third option:\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-typescript\"><html><head></head><body><span class=\"hljs-comment\">// handler.ts</span>\n<span class=\"hljs-comment\">// line starting from 575</span>\n\n<span class=\"hljs-comment\">// Files that present in current directory snapshot</span>\n<span class=\"hljs-comment\">// but absent in previous are added to watch list and</span>\n<span class=\"hljs-comment\">// emit `add` event.</span>\n<span class=\"hljs-keyword\">if</span> (item === target || (!target &amp;&amp; !previous.<span class=\"hljs-title function_\">has</span>(item))) {\n  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">fsw</span>.<span class=\"hljs-title function_\">_incrReadyCount</span>();\n\n  <span class=\"hljs-comment\">// ensure relativeness of path is preserved in case of watcher reuse</span>\n  path = sp.<span class=\"hljs-title function_\">join</span>(dir, sp.<span class=\"hljs-title function_\">relative</span>(dir, path));\n\n  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">_addToNodeFs</span>(path, initialAdd, wh, depth + <span class=\"hljs-number\">1</span>);\n}\n</body></html></code></pre>\n</div>\n</div>\n</div>\n<div id=\"outline-container-inotify-tools\" class=\"outline-3\">\n<a href=\"#inotify-tools\"><h3 id=\"inotify-tools\" class=\"cr-self-reference \">inotify-tools</h3></a>\n<div class=\"outline-text-3\" id=\"text-inotify-tools\">\n<p>\n<a href=\"https://github.com/inotify-tools/inotify-tools\">inotify-tools</a> is a set of cli tools providing interface to <code>inotify</code>. It was written in C++ and newer version is rewritten in Rust.\n</p>\n\n<p>\nBy default, <code>inotify-wait</code> quits after it detected a change. Therefore the problem described in the previous section is naturally up to the user to solve.\n</p>\n\n<p>\nIt also provides an <code>--monitor</code> option to continuously monitoring the changes happened in a directory. With <code>--monitor</code> on, it seems to choose the second option described in the previous section.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-bash\"><html><head></head><body>&gt; inotifywait -mr -e create .\n\nSetting up watches.  Beware: since -r was given, this may take a <span class=\"hljs-keyword\">while</span>!\nWatches established.\n\n<span class=\"hljs-comment\"># executing `mkdir -p s1/s2/s3/s4` in another shell session</span>\n\n./ CREATE,ISDIR s1\nWatching new directory ./s1/\n</body></html></code></pre>\n</div>\n\n<p>\nIf we create the directories one by one, all the directories will be notified. However, by using <code>-p</code> option to create multiple level of directories at once. Only the first one will be notified.\n</p>\n\n<p>\nWe can further confirm it by reading the source code:\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-cpp\"><html><head></head><body><span class=\"hljs-comment\">// inotifywait.cpp</span>\n<span class=\"hljs-comment\">// L391, main function</span>\n\n<span class=\"hljs-keyword\">do</span> {\n  event = <span class=\"hljs-built_in\">inotifytools_next_event</span>(timeout);\n\n  <span class=\"hljs-comment\">/*\n   * ......\n   */</span>\n\n  <span class=\"hljs-keyword\">if</span> (monitor &amp;&amp; recursive) {\n    <span class=\"hljs-keyword\">if</span> ((event-&gt;mask &amp; IN_CREATE) ||\n        (!moved_from &amp;&amp; (event-&gt;mask &amp; IN_MOVED_TO))) {\n      <span class=\"hljs-comment\">// New file - if it is a directory, watch it</span>\n      <span class=\"hljs-type\">char</span> *new_file = <span class=\"hljs-built_in\">inotifytools_dirpath_from_event</span>(event);\n      <span class=\"hljs-keyword\">if</span> (new_file &amp;&amp; *new_file &amp;&amp; <span class=\"hljs-built_in\">isdir</span>(new_file)) {\n        <span class=\"hljs-keyword\">if</span> (!quiet) {\n          <span class=\"hljs-built_in\">output_error</span>(sysl, <span class=\"hljs-string\">&quot;Watching new directory %s\\n&quot;</span>, new_file);\n        }\n        <span class=\"hljs-keyword\">if</span> (!<span class=\"hljs-built_in\">inotifytools_watch_recursively</span>(new_file, events)) {\n          <span class=\"hljs-built_in\">output_error</span>(sysl, <span class=\"hljs-string\">&quot;Couldn't watch new directory %s: %s\\n&quot;</span>, new_file,\n                       <span class=\"hljs-built_in\">strerror</span>(<span class=\"hljs-built_in\">inotifytools_error</span>()));\n        }\n      }\n      <span class=\"hljs-built_in\">free</span>(new_file);\n    } \n\n    <span class=\"hljs-comment\">/*\n     * ......\n     */</span>\n  }\n  <span class=\"hljs-built_in\">fflush</span>(<span class=\"hljs-literal\">NULL</span>);\n} <span class=\"hljs-keyword\">while</span> (monitor)\n</body></html></code></pre>\n</div>\n\n<p>\nThe program constantly polls and prints new events in the main function. If the newly created object is a directory and <code>--recursive</code> option is on, it recursively watch the newly created directory. However, it won't print files in the new directory if we check the <code>inotifytools_watch_recursively</code> function.\n</p>\n</div>\n</div>\n</div>\n<div id=\"outline-container-conclusion\" class=\"outline-2\">\n<a href=\"#conclusion\"><h2 id=\"conclusion\" class=\"cr-self-reference \">Conclusion</h2></a>\n<div class=\"outline-text-2\" id=\"text-conclusion\">\n<p>\nThere doesn't seem to a definitive solution to this issue. The workaround described in <a href=\"#the-workaround\">section 2</a> seems to be good enough in my case. I will conclude this post by posing a simple example usage of the code with the workaround applied.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-name\">deftest</span> wach_service_example\n  (<span class=\"hljs-name\">testing</span> <span class=\"hljs-string\">&quot;&quot;</span>\n    (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [test-dir (<span class=\"hljs-name\"><span class=\"hljs-built_in\">str</span></span> *test-dir* <span class=\"hljs-string\">&quot;/example&quot;</span>)]\n      (<span class=\"hljs-name\">.mkdirs</span> (<span class=\"hljs-name\">io/file</span> test-dir))\n      (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [[resp cancel] (<span class=\"hljs-name\">subject/watch</span> test-dir)\n            worker (<span class=\"hljs-name\"><span class=\"hljs-built_in\">future</span></span>\n                     (<span class=\"hljs-name\"><span class=\"hljs-built_in\">loop</span></span> [event (<span class=\"hljs-name\">a/&lt;!!</span> resp)\n                            result (<span class=\"hljs-name\"><span class=\"hljs-built_in\">transient</span></span> [])]\n                       (<span class=\"hljs-name\"><span class=\"hljs-built_in\">if</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">not</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">nil?</span></span> event))\n                         (<span class=\"hljs-name\"><span class=\"hljs-built_in\">recur</span></span> (<span class=\"hljs-name\">a/&lt;!!</span> resp)\n                                (<span class=\"hljs-name\"><span class=\"hljs-built_in\">conj!</span></span> result\n                                       {<span class=\"hljs-symbol\">:kind</span> (<span class=\"hljs-symbol\">:kind</span> event)\n                                        <span class=\"hljs-symbol\">:path</span> (<span class=\"hljs-name\">.toString</span> (<span class=\"hljs-symbol\">:path</span> event))}))\n                         (<span class=\"hljs-name\"><span class=\"hljs-built_in\">persistent!</span></span> result))))]\n        (<span class=\"hljs-name\">.sleep</span> java.util.concurrent.TimeUnit/MILLISECONDS <span class=\"hljs-number\">200</span>)\n        (<span class=\"hljs-name\">.mkdirs</span> (<span class=\"hljs-name\">io/file</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">str</span></span> test-dir <span class=\"hljs-string\">&quot;/s1/s2&quot;</span>)))\n        (<span class=\"hljs-name\">.createNewFile</span> (<span class=\"hljs-name\">io/file</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">str</span></span> test-dir <span class=\"hljs-string\">&quot;/s1/s2/file&quot;</span>)))\n        <span class=\"hljs-comment\">;; We can't delete the files too quickly after they are created,</span>\n        <span class=\"hljs-comment\">;;    otherwise we will receive no event.</span>\n        (<span class=\"hljs-name\">.sleep</span> java.util.concurrent.TimeUnit/MILLISECONDS <span class=\"hljs-number\">200</span>)\n        (<span class=\"hljs-name\"><span class=\"hljs-built_in\">doseq</span></span> [f (<span class=\"hljs-name\"><span class=\"hljs-built_in\">reverse</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">rest</span></span> (<span class=\"hljs-name\">file-seq</span> (<span class=\"hljs-name\">io/file</span> test-dir))))]\n          (<span class=\"hljs-name\">.delete</span> f))\n        (<span class=\"hljs-name\">.sleep</span> java.util.concurrent.TimeUnit/MILLISECONDS <span class=\"hljs-number\">200</span>)\n        <span class=\"hljs-comment\">;; shutdown the watch service</span>\n        (<span class=\"hljs-name\">a/&gt;!!</span> cancel <span class=\"hljs-literal\">true</span>)\n\n        <span class=\"hljs-comment\">;; verify the result</span>\n        (<span class=\"hljs-name\">is</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">=</span></span> [{<span class=\"hljs-symbol\">:kind</span> <span class=\"hljs-symbol\">:entry-create</span><span class=\"hljs-punctuation\">,</span>\t\t  \n                         <span class=\"hljs-symbol\">:path</span> <span class=\"hljs-string\">&quot;test/resource/watch_service_test/example/s1&quot;</span>}\n                        {<span class=\"hljs-symbol\">:kind</span> <span class=\"hljs-symbol\">:entry-create</span><span class=\"hljs-punctuation\">,</span>\n                         <span class=\"hljs-symbol\">:path</span> <span class=\"hljs-string\">&quot;test/resource/watch_service_test/example/s1/s2&quot;</span>}\n                        {<span class=\"hljs-symbol\">:kind</span> <span class=\"hljs-symbol\">:entry-create</span><span class=\"hljs-punctuation\">,</span>\n                         <span class=\"hljs-symbol\">:path</span> <span class=\"hljs-string\">&quot;test/resource/watch_service_test/example/s1/s2/file&quot;</span>}\n                        {<span class=\"hljs-symbol\">:kind</span> <span class=\"hljs-symbol\">:entry-delete</span><span class=\"hljs-punctuation\">,</span>\n                         <span class=\"hljs-symbol\">:path</span> <span class=\"hljs-string\">&quot;test/resource/watch_service_test/example/s1/s2/file&quot;</span>}\n                        {<span class=\"hljs-symbol\">:kind</span> <span class=\"hljs-symbol\">:entry-delete</span><span class=\"hljs-punctuation\">,</span>\n                         <span class=\"hljs-symbol\">:path</span> <span class=\"hljs-string\">&quot;test/resource/watch_service_test/example/s1/s2&quot;</span>}\n                        {<span class=\"hljs-symbol\">:kind</span> <span class=\"hljs-symbol\">:entry-delete</span><span class=\"hljs-punctuation\">,</span>\n                         <span class=\"hljs-symbol\">:path</span> <span class=\"hljs-string\">&quot;test/resource/watch_service_test/example/s1&quot;</span>}]\n               @worker))))))\n</body></html></code></pre>\n</div>\n\n<p>\nYou can also find the source code and some unit tests <a href=\"https://gist.github.com/imakira/4b537a13ecd8c1816427068d10777565\">here</a>.\n</p>\n</div>\n</div>\n","blog/orgx-require":null,"blog/modified-date":"2025-12-14T00:36:14+08:00"}