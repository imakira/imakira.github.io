<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8" /><meta content="ie=edge" http-equiv="x-ua-compatible" /><meta content="I recently tried to build a Common Lisp project using Nix and found it is quite easy with just the  buildASDFSystem  function in nixpkgs and ASDF alone. I ..." name="description" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>Develop and Build a Common Lisp Project using Nix | Coruscation.net</title><link href="https://fonts.googleapis.com" rel="preconnect" /><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" /><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;display=swap" rel="stylesheet" /><link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&amp;icon_names=keyboard_arrow_down" rel="stylesheet" /><link href="/main.css?v=1764058791681" rel="stylesheet" /><link href="https://coruscation.net/atom.xml" rel="alternate" title="Coruscation.net" type="application/rss+xml" /></head><body><div id="root"><div class="app h-dvh w-full xl:grid xl:grid-cols-[20rem_9fr]"><div class="transition-all"><div class="bg-opacity-100 px-4 relative bg-[#0260B3] sm:flex sm:justify-between block gap-4 xl:grid xl:grid-cols-[2fr_3fr] xl:h-dvh xl:fixed xl:w-[20rem]"><a class="flex justify-center block" href="/"><span class="text-3xl text-cyan-50 pt-4 sm:py-6 xl:sideways-lr xl:text-6xl xl:pb-8">Coruscation.net</span></a><div class="flex justify-center"><div class="flex flex-col items-center justify-end py-1 relative left-[0.275rem] sm:items-end xl:justify-between"><div class="navigator-bar gap-3 text-base text-slate-50 opacity-80 flex px-5 my-2 xl:text-2xl xl:flex-col xl:pt-6"><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300 group-hover:bg-yellow-400"></div><div class="relative w-full h-full"><div class="px-1 group-hover:text-cyan-50 text-lg"><a href="/">HOME</a></div></div></div><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300 group-hover:bg-yellow-400"></div><div class="relative w-full h-full"><div class="px-1 group-hover:text-cyan-50 text-lg"><a href="https://github.com/imakira">ABOUT</a></div></div></div><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300 group-hover:bg-yellow-400"></div><div class="relative w-full h-full"><div class="px-1 group-hover:text-cyan-50 text-lg"><a href="https://github.com/imakira">PROJECTS</a></div></div></div></div><div class="justify-center w-full mb-8 relative hidden xl:flex"><div class="flex relative"><a href="/atom.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="40" height="32">&lt;!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --&gt;<path d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path></svg></a><a href="https://github.com/imakira/cerulean"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" width="40" height="32">&lt;!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --&gt;<path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div></div></div></div></div></div><main class="pt-5 px-2 sm:px-4 xl:pt-7 xl:px-8"><div class="px-4 relative"><div><h1 class="font-medium text-neutral-700 leading-tight text-2xl sm:text-[2rem]">Develop and Build a Common Lisp Project using Nix</h1><hr class="border-t-1 border-slate-500 w-full my-3"/><div class="text-base grid items-center text-gray-700 pl-[1px] grid-cols-[7rem_1fr]"><div class="text-sky-700 border-l-2 pl-2 text-lg">Coding</div><div class="text-base">Oct 27, 2025</div></div></div><div></div><input id="toc-mobile-control" class="hidden" type="checkbox"/><label class=" toc-header cursor-pointer select-none block text-sky-700 border-1 pl-2  flex justify-between items-center mt-3 bg-white sticky top-0 h-8 pr-1  md:hidden ml-[1px] relative " for="toc-mobile-control"><div class="relative h-full w-full overflow-hidden"><div class="text-lg toc-header-text relative  w-full transition-all "><div class="h-8 w-96">Table Of Content</div><div class="h-8 w-96 overflow-hidden">Simple Configuration When Developing</div><div class="h-8 w-96 overflow-hidden">Building an Executable</div><div class="h-8 w-96 overflow-hidden">Limitations of This Method and Other Notes</div></div></div><span class="material-symbols-outlined checked:rotate-180 transition-all dropdown-icon">keyboard_arrow_down</span></label><div class="toc-mobile-wrapper2 h-1 sticky top-8"><div class="grid toc-mobile-wrapper transition-all border-neutral-400 border-l-1 bg-white md:hidden ml-[1px] "><ul class="toc-mobile-content text-[1.05rem] 2xl:text-lg "><li class="my-1 list-inside text-neutral-600"><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300"></div><div class="relative w-full h-full"><div class="group w-full h-full"><a class="h-12 transition-all w-full h-full inline-block flex flex-col justify-center group-hover:text-[#0260B3] pl-4" href="#simple-configuration-when-developing"><span>Simple Configuration When Developing</span></a></div></div></div></li><li class="my-1 list-inside text-neutral-600"><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300"></div><div class="relative w-full h-full"><div class="group w-full h-full"><a class="h-12 transition-all w-full h-full inline-block flex flex-col justify-center group-hover:text-[#0260B3] pl-4" href="#building-an-executable"><span>Building an Executable</span></a></div></div></div></li><li class="my-1 list-inside text-neutral-600"><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300"></div><div class="relative w-full h-full"><div class="group w-full h-full"><a class="h-12 transition-all w-full h-full inline-block flex flex-col justify-center group-hover:text-[#0260B3] pl-4" href="#limitations-of-this-method-and-other-notes"><span>Limitations of This Method and Other Notes</span></a></div></div></div></li></ul></div></div><div class="gap-8 w-full h-full md:grid md:grid-cols-[minmax(0px,7fr)_minmax(17rem,17rem)] 2xl:grid-cols-[minmax(0px,7fr)_minmax(20rem,20rem)]"><div class="cr-document md:mt-1"><p>
I recently tried to build a Common Lisp project using Nix and found it is quite easy with just the <code>buildASDFSystem</code> function in nixpkgs and ASDF alone. I will share how I have done it here in case someone else finds it useful.
</p>
<div id="outline-container-simple-configuration-when-developing" class="outline-2">
<a href="#simple-configuration-when-developing"><h2 id="simple-configuration-when-developing" class="cr-self-reference ">Simple Configuration When Developing</h2></a>
<div class="outline-text-2" id="text-simple-configuration-when-developing">
<p>
On the Nix we will have something like this:
</p>
<div class="org-src-container">
<pre class="cr-highlighted"><code class="lang-nix"><html><head></head><body><span class="hljs-comment"># flake.nix</span>
{
  <span class="hljs-attr">description</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;
  <span class="hljs-attr">inputs.flake-utils.url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;github:numtide/flake-utils&quot;</span>;
  <span class="hljs-attr">inputs.nixpkgs.url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;github:NixOS/nixpkgs/nixos-unstable&quot;</span>;
  <span class="hljs-attr">outputs</span> <span class="hljs-operator">=</span> { self, flake-utils, nixpkgs }:
    flake-utils.lib.eachDefaultSystem (<span class="hljs-params">system:</span>
      <span class="hljs-keyword">let</span> pkgs <span class="hljs-operator">=</span> nixpkgs.legacyPackages.${system};
      <span class="hljs-keyword">in</span> <span class="hljs-keyword">rec</span> {
        <span class="hljs-attr">packages.default</span> <span class="hljs-operator">=</span> pkgs.sbcl.buildASDFSystem {
          <span class="hljs-attr">pname</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;proj-name&quot;</span>;
          <span class="hljs-attr">version</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;0.1&quot;</span>;
          <span class="hljs-attr">src</span> <span class="hljs-operator">=</span> self;
          <span class="hljs-attr">lispLibs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">with</span> pkgs.sbclPackages; [
            alexandria
            <span class="hljs-comment"># lisp packages in nixpkgs go here</span>
          ];
          <span class="hljs-attr">nativeLibs</span> <span class="hljs-operator">=</span> [
            <span class="hljs-comment"># native libs go here</span>
          ];
        };
      }
    );
}
</body></html></code></pre>
</div>

<p>
On the Lisp side we will have an <code>asd</code> file
</p>
<div class="org-src-container">
<pre class="cr-highlighted"><code class="lang-lisp"><html><head></head><body><span class="hljs-comment">;; proj-name.asd</span>
(<span class="hljs-name">require</span> 'asdf)
(<span class="hljs-name">asdf</span><span class="hljs-symbol">:defsystem</span> <span class="hljs-string">&quot;proj-name&quot;</span>
  <span class="hljs-symbol">:depends-on</span> (<span class="hljs-name">#</span><span class="hljs-symbol">:alexandria</span>)
  <span class="hljs-symbol">:components</span> ((<span class="hljs-symbol">:file</span> <span class="hljs-string">&quot;main&quot;</span>))) <span class="hljs-comment">;; we will have a main.lisp file</span>
</body></html></code></pre>
</div>

<p>
With these two files we can then start developing the project with the following steps
</p>

<ul class="org-ul">
<li>Enter nix develop environment by executing <code>nix develop .</code> in the directory the project.</li>
<li>Launch Emacs inside the developing environment.</li>
<li>Launch <code>sly</code> (or <code>slime</code>) in Emacs, and load the <code>asd</code> file by <code>sly-compile-and-load-file</code>.</li>
<li>Execute <code>(asdf:load-system &quot;proj-name&quot;)</code> in the <code>sly</code> repl.</li>
<li>Enjoy!</li>
</ul>
</div>
</div>
<div id="outline-container-building-an-executable" class="outline-2">
<a href="#building-an-executable"><h2 id="building-an-executable" class="cr-self-reference ">Building an Executable</h2></a>
<div class="outline-text-2" id="text-building-an-executable">
<p>
To build an executable we need a few more snippets on the Nix side
</p>

<div class="org-src-container">
<pre class="cr-highlighted"><code class="lang-nix"><html><head></head><body><span class="hljs-comment">#...</span>

<span class="hljs-attr">packages.default</span> <span class="hljs-operator">=</span> pkgs.sbcl.buildASDFSystem {
  <span class="hljs-comment"># ...</span>
  <span class="hljs-comment"># other code is omitted here</span>
  <span class="hljs-attr">lispLibs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">with</span> pkgs.sbclPackages; [
    alexandria
    <span class="hljs-comment"># lisp packages in nixpkgs go here</span>
  ];

  <span class="hljs-attr">nativeBuildInputs</span> <span class="hljs-operator">=</span> [
    pkgs.makeWrapper
  ];

  <span class="hljs-attr">buildScript</span> <span class="hljs-operator">=</span> pkgs.writeText <span class="hljs-string">&quot;build-awesomes&quot;</span> <span class="hljs-string">''
    (require 'asdf)
    (asdf:load-system &quot;proj-name&quot;)
    (sb-ext:save-lisp-and-die
                &quot;proj-name&quot;
                :executable t
                #+sb-core-compression :compression
                #+sb-core-compression t
                ;; assume we have the `main' function defined and exported in the main.lisp file
                :toplevel #'main:main) 
  ''</span>;

  <span class="hljs-attr">installPhase</span> <span class="hljs-operator">=</span>   <span class="hljs-string">''
    runHook preInstall
    mkdir -p $out/bin
    cp proj-name $out/bin

    # make sure the executable can find dynamically linked libraries
    wrapProgram $out/bin/proj-name \
                --prefix LD_LIBRARY_PATH : $LD_LIBRARY_PATH
    runHook postInstall
  ''</span>;
};
</body></html></code></pre>
</div>

<p>
When we execute <code>nix build .</code> in the project directory, lisp scripts in <code>buildScript</code> will be executed and generates a binary file <code>proj-name</code>. The binary file will then be copied into <code>$out/bin</code> directory by the scripts inside <code>installPhase</code>. After the <code>nix build .</code> finished, we can find the executable in the <code>result/bin/</code> directory
</p>

<p>
We can also use <code>nix run .</code> to run the result executable directly.
</p>
</div>
</div>
<div id="outline-container-limitations-of-this-method-and-other-notes" class="outline-2">
<a href="#limitations-of-this-method-and-other-notes"><h2 id="limitations-of-this-method-and-other-notes" class="cr-self-reference ">Limitations of This Method and Other Notes</h2></a>
<div class="outline-text-2" id="text-limitations-of-this-method-and-other-notes">
<p>
The biggest limitation of this solution may be you need to restart the REPL (or even the Emacs launched inside the develop environment) every time you add a package into the <code>flake.nix</code>.
</p>

<p>
You can find the lisp section of the nixpkgs documentation <a href="https://nixos.org/manual/nixpkgs/stable/#lisp-overview">here</a>. <a href="https://github.com/NixOS/nixpkgs/blob/nixos-unstable/pkgs/development/lisp-modules/packages.nix">packages.nix</a> in the nixpkgs also has plenty lisp project definitions we can take references from.
</p>

<p>
I have a <a href="https://github.com/imakira/awesomes">little project</a> built this way and it runs on github actions simply by using <code>nix run .</code>, you can also check that.
</p>
</div>
</div>
</div><div class="mt-4"><div class="border-neutral-400 border-l-2 text-[1.05rem] 2xl:text-lg w-78 fixed right-0 top-[13.5rem] z-200 max-h-[80vh] overflow-y-auto select-none hidden md:block xl:top-36  2xl:w-96"><ul><li class="my-1 list-inside text-neutral-600"><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300"></div><div class="relative w-full h-full"><div class="group w-full h-full"><a class="h-12 transition-all w-full h-full inline-block flex flex-col justify-center group-hover:text-[#0260B3] pl-4" href="#simple-configuration-when-developing"><span>Simple Configuration When Developing</span></a></div></div></div></li><li class="my-1 list-inside text-neutral-600"><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300"></div><div class="relative w-full h-full"><div class="group w-full h-full"><a class="h-12 transition-all w-full h-full inline-block flex flex-col justify-center group-hover:text-[#0260B3] pl-4" href="#building-an-executable"><span>Building an Executable</span></a></div></div></div></li><li class="my-1 list-inside text-neutral-600"><div class="relative group"><div class="absolute w-0 h-full group-hover:bg-sky-200 group-hover:bg-opacity-70 group-hover:w-full group-hover:h-full transition-all duration-300"></div><div class="relative w-full h-full"><div class="group w-full h-full"><a class="h-12 transition-all w-full h-full inline-block flex flex-col justify-center group-hover:text-[#0260B3] pl-4" href="#limitations-of-this-method-and-other-notes"><span>Limitations of This Method and Other Notes</span></a></div></div></div></li></ul></div></div></div></div></main></div></div><script>window.__server_path = "/"</script><script>window.__cerulean_rehydrate = true;</script><script>globalThis["blog/develop-and-build-a-common-lisp-project-using-nix"] = {"description":"I recently tried to build a Common Lisp project using Nix and found it is quite easy with just the  buildASDFSystem  function in nixpkgs and ASDF alone. I ...","category":"Coding","tags":[],"email":null,"content":"<p>\nI recently tried to build a Common Lisp project using Nix and found it is quite easy with just the <code>buildASDFSystem</code> function in nixpkgs and ASDF alone. I will share how I have done it here in case someone else finds it useful.\n</p>\n<div id=\"outline-container-simple-configuration-when-developing\" class=\"outline-2\">\n<a href=\"#simple-configuration-when-developing\"><h2 id=\"simple-configuration-when-developing\" class=\"cr-self-reference \">Simple Configuration When Developing</h2></a>\n<div class=\"outline-text-2\" id=\"text-simple-configuration-when-developing\">\n<p>\nOn the Nix we will have something like this:\n</p>\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-nix\"><html><head></head><body><span class=\"hljs-comment\"># flake.nix</span>\n{\n  <span class=\"hljs-attr\">description</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;&quot;</span>;\n  <span class=\"hljs-attr\">inputs.flake-utils.url</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;github:numtide/flake-utils&quot;</span>;\n  <span class=\"hljs-attr\">inputs.nixpkgs.url</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;github:NixOS/nixpkgs/nixos-unstable&quot;</span>;\n  <span class=\"hljs-attr\">outputs</span> <span class=\"hljs-operator\">=</span> { self, flake-utils, nixpkgs }:\n    flake-utils.lib.eachDefaultSystem (<span class=\"hljs-params\">system:</span>\n      <span class=\"hljs-keyword\">let</span> pkgs <span class=\"hljs-operator\">=</span> nixpkgs.legacyPackages.${system};\n      <span class=\"hljs-keyword\">in</span> <span class=\"hljs-keyword\">rec</span> {\n        <span class=\"hljs-attr\">packages.default</span> <span class=\"hljs-operator\">=</span> pkgs.sbcl.buildASDFSystem {\n          <span class=\"hljs-attr\">pname</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;proj-name&quot;</span>;\n          <span class=\"hljs-attr\">version</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;0.1&quot;</span>;\n          <span class=\"hljs-attr\">src</span> <span class=\"hljs-operator\">=</span> self;\n          <span class=\"hljs-attr\">lispLibs</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">with</span> pkgs.sbclPackages; [\n            alexandria\n            <span class=\"hljs-comment\"># lisp packages in nixpkgs go here</span>\n          ];\n          <span class=\"hljs-attr\">nativeLibs</span> <span class=\"hljs-operator\">=</span> [\n            <span class=\"hljs-comment\"># native libs go here</span>\n          ];\n        };\n      }\n    );\n}\n</body></html></code></pre>\n</div>\n\n<p>\nOn the Lisp side we will have an <code>asd</code> file\n</p>\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-lisp\"><html><head></head><body><span class=\"hljs-comment\">;; proj-name.asd</span>\n(<span class=\"hljs-name\">require</span> 'asdf)\n(<span class=\"hljs-name\">asdf</span><span class=\"hljs-symbol\">:defsystem</span> <span class=\"hljs-string\">&quot;proj-name&quot;</span>\n  <span class=\"hljs-symbol\">:depends-on</span> (<span class=\"hljs-name\">#</span><span class=\"hljs-symbol\">:alexandria</span>)\n  <span class=\"hljs-symbol\">:components</span> ((<span class=\"hljs-symbol\">:file</span> <span class=\"hljs-string\">&quot;main&quot;</span>))) <span class=\"hljs-comment\">;; we will have a main.lisp file</span>\n</body></html></code></pre>\n</div>\n\n<p>\nWith these two files we can then start developing the project with the following steps\n</p>\n\n<ul class=\"org-ul\">\n<li>Enter nix develop environment by executing <code>nix develop .</code> in the directory the project.</li>\n<li>Launch Emacs inside the developing environment.</li>\n<li>Launch <code>sly</code> (or <code>slime</code>) in Emacs, and load the <code>asd</code> file by <code>sly-compile-and-load-file</code>.</li>\n<li>Execute <code>(asdf:load-system &quot;proj-name&quot;)</code> in the <code>sly</code> repl.</li>\n<li>Enjoy!</li>\n</ul>\n</div>\n</div>\n<div id=\"outline-container-building-an-executable\" class=\"outline-2\">\n<a href=\"#building-an-executable\"><h2 id=\"building-an-executable\" class=\"cr-self-reference \">Building an Executable</h2></a>\n<div class=\"outline-text-2\" id=\"text-building-an-executable\">\n<p>\nTo build an executable we need a few more snippets on the Nix side\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-nix\"><html><head></head><body><span class=\"hljs-comment\">#...</span>\n\n<span class=\"hljs-attr\">packages.default</span> <span class=\"hljs-operator\">=</span> pkgs.sbcl.buildASDFSystem {\n  <span class=\"hljs-comment\"># ...</span>\n  <span class=\"hljs-comment\"># other code is omitted here</span>\n  <span class=\"hljs-attr\">lispLibs</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">with</span> pkgs.sbclPackages; [\n    alexandria\n    <span class=\"hljs-comment\"># lisp packages in nixpkgs go here</span>\n  ];\n\n  <span class=\"hljs-attr\">nativeBuildInputs</span> <span class=\"hljs-operator\">=</span> [\n    pkgs.makeWrapper\n  ];\n\n  <span class=\"hljs-attr\">buildScript</span> <span class=\"hljs-operator\">=</span> pkgs.writeText <span class=\"hljs-string\">&quot;build-awesomes&quot;</span> <span class=\"hljs-string\">''\n    (require 'asdf)\n    (asdf:load-system &quot;proj-name&quot;)\n    (sb-ext:save-lisp-and-die\n                &quot;proj-name&quot;\n                :executable t\n                #+sb-core-compression :compression\n                #+sb-core-compression t\n                ;; assume we have the `main' function defined and exported in the main.lisp file\n                :toplevel #'main:main) \n  ''</span>;\n\n  <span class=\"hljs-attr\">installPhase</span> <span class=\"hljs-operator\">=</span>   <span class=\"hljs-string\">''\n    runHook preInstall\n    mkdir -p $out/bin\n    cp proj-name $out/bin\n\n    # make sure the executable can find dynamically linked libraries\n    wrapProgram $out/bin/proj-name \\\n                --prefix LD_LIBRARY_PATH : $LD_LIBRARY_PATH\n    runHook postInstall\n  ''</span>;\n};\n</body></html></code></pre>\n</div>\n\n<p>\nWhen we execute <code>nix build .</code> in the project directory, lisp scripts in <code>buildScript</code> will be executed and generates a binary file <code>proj-name</code>. The binary file will then be copied into <code>$out/bin</code> directory by the scripts inside <code>installPhase</code>. After the <code>nix build .</code> finished, we can find the executable in the <code>result/bin/</code> directory\n</p>\n\n<p>\nWe can also use <code>nix run .</code> to run the result executable directly.\n</p>\n</div>\n</div>\n<div id=\"outline-container-limitations-of-this-method-and-other-notes\" class=\"outline-2\">\n<a href=\"#limitations-of-this-method-and-other-notes\"><h2 id=\"limitations-of-this-method-and-other-notes\" class=\"cr-self-reference \">Limitations of This Method and Other Notes</h2></a>\n<div class=\"outline-text-2\" id=\"text-limitations-of-this-method-and-other-notes\">\n<p>\nThe biggest limitation of this solution may be you need to restart the REPL (or even the Emacs launched inside the develop environment) every time you add a package into the <code>flake.nix</code>.\n</p>\n\n<p>\nYou can find the lisp section of the nixpkgs documentation <a href=\"https://nixos.org/manual/nixpkgs/stable/#lisp-overview\">here</a>. <a href=\"https://github.com/NixOS/nixpkgs/blob/nixos-unstable/pkgs/development/lisp-modules/packages.nix\">packages.nix</a> in the nixpkgs also has plenty lisp project definitions we can take references from.\n</p>\n\n<p>\nI have a <a href=\"https://github.com/imakira/awesomes\">little project</a> built this way and it runs on github actions simply by using <code>nix run .</code>, you can also check that.\n</p>\n</div>\n</div>\n","published-date":"2025-10-27T17:50:17+08:00","title":"Develop and Build a Common Lisp Project using Nix","show-toc?":true,"author":null,"language":"en_US","id":"develop-and-build-a-common-lisp-project-using-nix","file-path":"/home/void/Projects/imakira.github.io/blogs/build-a-commonlisp-project-with-nix.org","modified-date":"2025-10-27T17:50:17+08:00"};
globalThis[":title"] = "Develop and Build a Common Lisp Project using Nix | Coruscation.net";
globalThis[":description"] = "I recently tried to build a Common Lisp project using Nix and found it is quite easy with just the  buildASDFSystem  function in nixpkgs and ASDF alone. I ...";</script><script src="/js/main.js"></script></body></html>