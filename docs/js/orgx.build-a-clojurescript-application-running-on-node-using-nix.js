import { $APP, shadow$provide } from "./default.js";
import "./shared.js";
const shadow_esm_import = function(x) { return import(x) };
var wG=function(a){a=$APP.em(a);$APP.Al.g(a);return $APP.Kl($APP.Zy,$APP.Cl(wH,[],!1),[$APP.Il($APP.Cg,[$APP.Q],[$APP.Kl($APP.Zy,$APP.Cl(BH,[],!1),[])]),uG,sI,LI,SI,XI])},DG=function(a){a=$APP.em(a);$APP.Al.g(a);return $APP.Il(wG,$APP.$n($APP.xm.u($APP.H([$APP.Oo([$APP.Tj,$APP.Nl,$APP.Lj,$APP.Zl,$APP.Mk,$APP.am,$APP.zl,$APP.dm,$APP.Lk,$APP.jj,$APP.Sj,$APP.Zi,$APP.Vl,$APP.Yl,$APP.ll,$APP.Uj],[!0,$APP.Zg,!1,"Build a ClojureScript Application Running on Node Using Nix",!0,"/home/void/Projects/imakira.github.io/blogs/build-a-clojurescript-application-running-on-node-using-nix.org",
null,null,"To build a ClojureScript application, we need to pull dependencies from two package managers. That is, JavaScript packages from  npm  and Clojure packages ...","build-a-clojurescript-application-running-on-node-using-nix","Coding","en_US","2025-11-03T17:25:27+08:00",'\x3cp\x3e\nTo build a ClojureScript application, we need to pull dependencies from two package managers. That is, JavaScript packages from \x3ccode\x3enpm\x3c/code\x3e and Clojure packages from \x3ccode\x3edeps.edn\x3c/code\x3e. After pulling the dependencies, we can then let \x3ccode\x3eshadow-cljs\x3c/code\x3e compiles the ClojureScript files into a single javascript and make the result a npm package. In this post, we rely on \x3ccode\x3enixpkgs\x3c/code\x3e\'s builtin \x3ccode\x3efetchNpmDeps\x3c/code\x3e and \x3ccode\x3ebuildNpmPackage\x3c/code\x3e for the npm side, and \x3ca href\x3d"https://github.com/jlesquembre/clj-nix"\x3eclj-nix\x3c/a\x3e for the nix side.\n\x3c/p\x3e\n\n\x3cpre class\x3d"orgx" data-wrapper\x3d"use-comp" data-wrapper-data\x3d"note"\x3e\x3cul class\x3d"org-ul"\x3e\n\x3cli\x3e\x3cb\x3echangelog\x3c/b\x3e   Jan 17, 2026: use a new method to build the nix package, supports git repos, reduces output size.\x3c/li\x3e\n\x3c/ul\x3e\n\n\x3c/pre\x3e\n\x3cdiv id\x3d"outline-container-prerequisites" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#prerequisites"\x3e\x3ch2 id\x3d"prerequisites" class\x3d"cr-self-reference "\x3ePrerequisites\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-prerequisites"\x3e\n\x3cp\x3e\nI will skip the details that are not unique to Nix. The following contents assume we already have a working shadow-cljs project that can produce a node.js target when running \x3ccode\x3enpm run release\x3c/code\x3e. Which is basically:\n\x3c/p\x3e\n\n\x3cul class\x3d"org-ul"\x3e\n\x3cli\x3ea \x3ccode\x3e:node-script\x3c/code\x3e target in \x3ccode\x3eshadow-cljs.edn\x3c/code\x3e, with \x3ccode\x3e:main\x3c/code\x3e function specified\x3c/li\x3e\n\x3cli\x3ea \x3ccode\x3erelease\x3c/code\x3e script in package.json, most probably \x3ccode\x3eshadow-cljs release script\x3c/code\x3e\x3c/li\x3e\n\x3cli\x3ean entry script specified in \x3ccode\x3ebin\x3c/code\x3e in package.json.\x3c/li\x3e\n\x3c/ul\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-prefetch-and-generate-lock-file-for-dependencies" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#prefetch-and-generate-lock-file-for-dependencies"\x3e\x3ch2 id\x3d"prefetch-and-generate-lock-file-for-dependencies" class\x3d"cr-self-reference "\x3ePrefetch and generate lock file for dependencies\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-prefetch-and-generate-lock-file-for-dependencies"\x3e\n\x3cp\x3e\nDuring the \x3ci\x3ebuild\x3c/i\x3e phase of nix package, the process cannot perform any network request, as that will defeat the whole point of \x3ci\x3edeterminism\x3c/i\x3e. The common practice is to use a \x3ci\x3elock file\x3c/i\x3e. Which is essentially a recipe of all the necessary resources (and their checksums) for the building process. We can then prefetch all the resources into the nix store and tell the building process where to find the necessary resources during the actual building.\n\x3c/p\x3e\n\n\x3cp\x3e\nOn the npm side, we do it by running the following command. It will output a sha256 code, we save it for later.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-bash"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3enix run nixpkgs#prefetch-npm-deps package-lock.json\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nOn the Clojure side, we execute the following command. It will generate a \x3ccode\x3edeps-lock.json\x3c/code\x3e file. We will refer it in the \x3ccode\x3eflake.nix\x3c/code\x3e.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-bash"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3enix run github:jlesquembre/clj-nix#deps-lock\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-build-with-shadow-cljs-and-~mkcljlib~" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#build-with-shadow-cljs-and-~mkcljlib~"\x3e\x3ch2 id\x3d"build-with-shadow-cljs-and-~mkcljlib~" class\x3d"cr-self-reference "\x3eBuild with shadow-cljs and \x3ccode\x3emkCljLib\x3c/code\x3e\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-build-with-shadow-cljs-and-~mkcljlib~"\x3e\n\x3cp\x3e\nWe need to add \x3ccode\x3eclj-nix\x3c/code\x3e\'s overlays to our flake.nix to be able to use \x3ccode\x3emkCljLib\x3c/code\x3e.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3ep\x3cspan class\x3d"hljs-attr"\x3ekgs\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-built_in"\x3eimport\x3c/span\x3e nixpkgs {\n  \x3cspan class\x3d"hljs-keyword"\x3einherit\x3c/span\x3e system;\n  \x3cspan class\x3d"hljs-attr"\x3eoverlays\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e [\n    clj-nix.overlays.default\n  ];\n};\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nFirst, we create a \x3ccode\x3enode_modules\x3c/code\x3e derivative which we will use later.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3ed\x3cspan class\x3d"hljs-attr"\x3eeps-hash\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;deps-hash\x26quot;\x3c/span\x3e;\n\n\x3cspan class\x3d"hljs-attr"\x3enpm-deps\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e pkgs.buildNpmPackage(\x3cspan class\x3d"hljs-params"\x3efinalAttrs:\x3c/span\x3e {\n  \x3cspan class\x3d"hljs-attr"\x3esrc\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e self;\n  \x3cspan class\x3d"hljs-attr"\x3epname\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;package-npm-deps\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3eversion\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;0.0\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3edontNpmBuild\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-literal"\x3etrue\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3enpmDepsHash\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e deps-hash;\n  \x3cspan class\x3d"hljs-attr"\x3einstallPhase\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\'\'\n  mkdir $out\n  cp -r ./node_modules $out/node_modules\n  \'\'\x3c/span\x3e;\n});\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nWe will use \x3ccode\x3emkCljLib\x3c/code\x3e to setup Clojure dependencies for us, while we copy JavaScript dependencies from the earlier step manually.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3eb\x3cspan class\x3d"hljs-attr"\x3euild\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e pkgs.mkCljLib {\n  \x3cspan class\x3d"hljs-attr"\x3eprojectSrc\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e self;\n  \x3cspan class\x3d"hljs-attr"\x3ename\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;espoir\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3ebuildCommand\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;\n  # copy node_modules from earlier step to build directory\n  cp -r \x3cspan class\x3d"hljs-subst"\x3e${npm-deps}\x3c/span\x3e/node_modules ./node_modules\n  \x3cspan class\x3d"hljs-subst"\x3e${pkgs.nodejs}\x3c/span\x3e/bin/npm run release\n  \x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3einstallPhase\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\'\'\n  mkdir -p $out\n  cp -R * $out/\n  \'\'\x3c/span\x3e;\n};\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nIn the \x3ccode\x3ebuildCommand\x3c/code\x3e, we setup the JavaScript dependencies, and call \x3ccode\x3enpm run release\x3c/code\x3e which in turn calls \x3ccode\x3eshadow-cljs\x3c/code\x3e to build the project.\n\x3c/p\x3e\n\n\x3cp\x3e\nIn \x3ccode\x3einstallPhase\x3c/code\x3e, we override the install process provided by \x3ccode\x3emkCljLib\x3c/code\x3e. Instead, we simply use all the files in the build directory as output.\n\x3c/p\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-package-results-as-a-npm-package" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#package-results-as-a-npm-package"\x3e\x3ch2 id\x3d"package-results-as-a-npm-package" class\x3d"cr-self-reference "\x3ePackage results as a npm package\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-package-results-as-a-npm-package"\x3e\n\x3cp\x3e\nWe can directly feed output from the earlier example to \x3ccode\x3ebuilNpmPackage\x3c/code\x3e. Since we already build the package, we will set \x3ccode\x3edontNpmBuild \x3d true;\x3c/code\x3e.\n\x3c/p\x3e\n\n\x3cp\x3e\nThe install process provided by \x3ccode\x3ebuildNpmPackage\x3c/code\x3e will package necessary dependencies and generate an executable calling the entry script. \n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3ep\x3cspan class\x3d"hljs-attr"\x3eackages.default\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e pkgs.buildNpmPackage {\n  \x3cspan class\x3d"hljs-attr"\x3epname\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;espoir\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3esrc\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e build;\n  \x3cspan class\x3d"hljs-attr"\x3edontNpmBuild\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-literal"\x3etrue\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3eversion\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;0.0.1\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3enpmDepsHash\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e deps-hash;\n};\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-tips" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#tips"\x3e\x3ch2 id\x3d"tips" class\x3d"cr-self-reference "\x3eTips\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-tips"\x3e\n\x3cul class\x3d"org-ul"\x3e\n\x3cli\x3eCheck \x3ca href\x3d"https://github.com/imakira/espoir/blob/main/flake.nix"\x3eimakira/espoir/blob/main/flake.nix\x3c/a\x3e for a working example.\x3c/li\x3e\n\x3c/ul\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n',
null,"2026-01-17T17:39:46+08:00"]),a]))),[])};var EG=(0,$APP.Y)("code",{children:["npm"]}),HG=(0,$APP.Y)("code",{children:["deps.edn"]}),$G=(0,$APP.Y)("code",{children:["shadow-cljs"]}),cH=(0,$APP.Y)("code",{children:["nixpkgs"]}),dH=(0,$APP.Y)("code",{children:["fetchNpmDeps"]}),gH=(0,$APP.Y)("code",{children:["buildNpmPackage"]}),kH=(0,$APP.Y)("a",{href:"https://github.com/jlesquembre/clj-nix",children:["clj-nix"]}),wH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nTo build a ClojureScript application, we need to pull dependencies from two package managers. That is, JavaScript packages from ",
EG," and Clojure packages from ",HG,". After pulling the dependencies, we can then let ",$G," compiles the ClojureScript files into a single javascript and make the result a npm package. In this post, we rely on ",cH,"'s builtin ",dH," and ",gH," for the npm side, and ",kH," for the nix side.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(wH.ref=null):wH.ref=null;
var nH=(0,$APP.Y)("b",{children:["changelog"]}),xH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:[nH,"   Jan 17, 2026: use a new method to build the nix package, supports git repos, reduces output size."]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(xH.ref=null):xH.ref=null;
var BH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"ul",props:{className:$APP.X.h(null,"org-ul"),children:[xH]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(BH.ref=null):BH.ref=null;
var bK=(0,$APP.Y)("h2",{className:$APP.X.h(null,"cr-self-reference "),id:"prerequisites",children:["Prerequisites"]}),EH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#prerequisites",children:[bK]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(EH.ref=null):EH.ref=null;
var fK=(0,$APP.Y)("code",{children:["npm run release"]}),HH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nI will skip the details that are not unique to Nix. The following contents assume we already have a working shadow-cljs project that can produce a node.js target when running ",fK,". Which is basically:\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(HH.ref=null):HH.ref=null;
var gK=(0,$APP.Y)("code",{children:[":node-script"]}),oK=(0,$APP.Y)("code",{children:["shadow-cljs.edn"]}),pK=(0,$APP.Y)("code",{children:[":main"]}),MH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["a ",gK," target in ",oK,", with ",pK," function specified"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(MH.ref=null):MH.ref=null;
var qK=(0,$APP.Y)("code",{children:["release"]}),rK=(0,$APP.Y)("code",{children:["shadow-cljs release script"]}),OH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["a ",qK," script in package.json, most probably ",rK]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(OH.ref=null):OH.ref=null;
var sK=(0,$APP.Y)("code",{children:["bin"]}),SH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["an entry script specified in ",sK," in package.json."]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(SH.ref=null):SH.ref=null;var UH={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"ul",props:{className:$APP.X.h(null,"org-ul"),children:[MH,OH,SH]},key:null,_owner:null,_store:{validated:!0}};
$APP.Z?$APP.k(null)&&(UH.ref=null):UH.ref=null;var bI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-text-2"),id:"text-prerequisites",children:[HH,UH]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(bI.ref=null):bI.ref=null;
var uG={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-2"),id:"outline-container-prerequisites",children:[EH,bI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(uG.ref=null):uG.ref=null;
var tK=(0,$APP.Y)("h2",{className:$APP.X.h(null,"cr-self-reference "),id:"prefetch-and-generate-lock-file-for-dependencies",children:["Prefetch and generate lock file for dependencies"]}),cI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#prefetch-and-generate-lock-file-for-dependencies",children:[tK]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(cI.ref=null):cI.ref=null;
var uK=(0,$APP.Y)("i",{children:["build"]}),vK=(0,$APP.Y)("i",{children:["determinism"]}),wK=(0,$APP.Y)("i",{children:["lock file"]}),dI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nDuring the ",uK," phase of nix package, the process cannot perform any network request, as that will defeat the whole point of ",vK,". The common practice is to use a ",wK,". Which is essentially a recipe of all the necessary resources (and their checksums) for the building process. We can then prefetch all the resources into the nix store and tell the building process where to find the necessary resources during the actual building.\n"]},
key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(dI.ref=null):dI.ref=null;
var xK=(0,$APP.Y)("p",{children:["\nOn the npm side, we do it by running the following command. It will output a sha256 code, we save it for later.\n"]}),yK=(0,$APP.Y)("code",{className:$APP.X.h(null,"lang-bash"),children:["nix run nixpkgs#prefetch-npm-deps package-lock.json\n"]}),jI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.X.h(null,"cr-highlighted"),children:[yK]},key:null,_owner:null,_store:{validated:!0}};
$APP.Z?$APP.k(null)&&(jI.ref=null):jI.ref=null;var vG={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"org-src-container"),children:[jI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(vG.ref=null):vG.ref=null;
var zK=(0,$APP.Y)("code",{children:["deps-lock.json"]}),AK=(0,$APP.Y)("code",{children:["flake.nix"]}),oI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nOn the Clojure side, we execute the following command. It will generate a ",zK," file. We will refer it in the ",AK,".\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(oI.ref=null):oI.ref=null;
var BK=(0,$APP.Y)("code",{className:$APP.X.h(null,"lang-bash"),children:["nix run github:jlesquembre/clj-nix#deps-lock\n"]}),pI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.X.h(null,"cr-highlighted"),children:[BK]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(pI.ref=null):pI.ref=null;
var qI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"org-src-container"),children:[pI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(qI.ref=null):qI.ref=null;
var rI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-text-2"),id:"text-prefetch-and-generate-lock-file-for-dependencies",children:[dI,xK,vG,oI,qI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(rI.ref=null):rI.ref=null;
var sI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-2"),id:"outline-container-prefetch-and-generate-lock-file-for-dependencies",children:[cI,rI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(sI.ref=null):sI.ref=null;
var CK=(0,$APP.Y)("code",{children:["mkCljLib"]}),tI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"h2",props:{className:$APP.X.h(null,"cr-self-reference "),id:"build-with-shadow-cljs-and-~mkcljlib~",children:["Build with shadow-cljs and ",CK]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(tI.ref=null):tI.ref=null;
var uI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#build-with-shadow-cljs-and-~mkcljlib~",children:[tI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(uI.ref=null):uI.ref=null;
var DK=(0,$APP.Y)("code",{children:["clj-nix"]}),vI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nWe need to add ",DK,"'s overlays to our flake.nix to be able to use ",CK,".\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(vI.ref=null):vI.ref=null;
var EK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["kgs"]}),FK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-operator"),children:["\x3d"]}),GK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-built_in"),children:["import"]}),HK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-keyword"),children:["inherit"]}),IK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["overlays"]}),wI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),
type:"code",props:{className:$APP.X.h(null,"lang-nix"),children:["p",EK," ",FK," ",GK," nixpkgs {\n  ",HK," system;\n  ",IK," ",FK," [\n    clj-nix.overlays.default\n  ];\n};\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(wI.ref=null):wI.ref=null;var xI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.X.h(null,"cr-highlighted"),children:[wI]},key:null,_owner:null,_store:{validated:!0}};
$APP.Z?$APP.k(null)&&(xI.ref=null):xI.ref=null;var yI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"org-src-container"),children:[xI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(yI.ref=null):yI.ref=null;
var JK=(0,$APP.Y)("code",{children:["node_modules"]}),zI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nFirst, we create a ",JK," derivative which we will use later.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(zI.ref=null):zI.ref=null;
var KK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["eps-hash"]}),LK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-string"),children:['"deps-hash"']}),MK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["npm-deps"]}),NK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-params"),children:["finalAttrs:"]}),OK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["src"]}),PK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["pname"]}),
QK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-string"),children:['"package-npm-deps"']}),RK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["version"]}),SK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-string"),children:['"0.0"']}),TK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["dontNpmBuild"]}),UK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-literal"),children:["true"]}),VK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["npmDepsHash"]}),
WK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["installPhase"]}),XK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-string"),children:["''\n  mkdir $out\n  cp -r ./node_modules $out/node_modules\n  ''"]}),AI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"code",props:{className:$APP.X.h(null,"lang-nix"),children:["d",KK," ",FK," ",LK,";\n\n",MK," ",FK," pkgs.buildNpmPackage(",NK," {\n  ",OK," ",FK," self;\n  ",PK," ",FK," ",QK,";\n  ",
RK," ",FK," ",SK,";\n  ",TK," ",FK," ",UK,";\n  ",VK," ",FK," deps-hash;\n  ",WK," ",FK," ",XK,";\n});\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(AI.ref=null):AI.ref=null;var BI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.X.h(null,"cr-highlighted"),children:[AI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(BI.ref=null):BI.ref=null;
var CI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"org-src-container"),children:[BI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(CI.ref=null):CI.ref=null;
var DI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nWe will use ",CK," to setup Clojure dependencies for us, while we copy JavaScript dependencies from the earlier step manually.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(DI.ref=null):DI.ref=null;
var YK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["uild"]}),ZK=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["projectSrc"]}),$K=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["name"]}),aL=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-string"),children:['"espoir"']}),bL=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["buildCommand"]}),cL=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-subst"),children:["${npm-deps}"]}),
dL=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-subst"),children:["${pkgs.nodejs}"]}),EI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"span",props:{className:$APP.X.h(null,"hljs-string"),children:['"\n  # copy node_modules from earlier step to build directory\n  cp -r ',cL,"/node_modules ./node_modules\n  ",dL,'/bin/npm run release\n  "']},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(EI.ref=null):EI.ref=null;
var eL=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-string"),children:["''\n  mkdir -p $out\n  cp -R * $out/\n  ''"]}),FI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"code",props:{className:$APP.X.h(null,"lang-nix"),children:["b",YK," ",FK," pkgs.mkCljLib {\n  ",ZK," ",FK," self;\n  ",$K," ",FK," ",aL,";\n  ",bL," ",FK," ",EI,";\n  ",WK," ",FK," ",eL,";\n};\n"]},key:null,_owner:null,_store:{validated:!0}};
$APP.Z?$APP.k(null)&&(FI.ref=null):FI.ref=null;var GI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.X.h(null,"cr-highlighted"),children:[FI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(GI.ref=null):GI.ref=null;var HI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"org-src-container"),children:[GI]},key:null,_owner:null,_store:{validated:!0}};
$APP.Z?$APP.k(null)&&(HI.ref=null):HI.ref=null;var fL=(0,$APP.Y)("code",{children:["buildCommand"]}),II={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nIn the ",fL,", we setup the JavaScript dependencies, and call ",fK," which in turn calls ",$G," to build the project.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(II.ref=null):II.ref=null;
var gL=(0,$APP.Y)("code",{children:["installPhase"]}),JI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nIn ",gL,", we override the install process provided by ",CK,". Instead, we simply use all the files in the build directory as output.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(JI.ref=null):JI.ref=null;
var KI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-text-2"),id:"text-build-with-shadow-cljs-and-~mkcljlib~",children:[vI,yI,zI,CI,DI,HI,II,JI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(KI.ref=null):KI.ref=null;
var LI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-2"),id:"outline-container-build-with-shadow-cljs-and-~mkcljlib~",children:[uI,KI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(LI.ref=null):LI.ref=null;
var hL=(0,$APP.Y)("h2",{className:$APP.X.h(null,"cr-self-reference "),id:"package-results-as-a-npm-package",children:["Package results as a npm package"]}),MI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#package-results-as-a-npm-package",children:[hL]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(MI.ref=null):MI.ref=null;
var iL=(0,$APP.Y)("code",{children:["builNpmPackage"]}),jL=(0,$APP.Y)("code",{children:["dontNpmBuild \x3d true;"]}),NI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nWe can directly feed output from the earlier example to ",iL,". Since we already build the package, we will set ",jL,".\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(NI.ref=null):NI.ref=null;
var xG={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nThe install process provided by ",gH," will package necessary dependencies and generate an executable calling the entry script. \n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(xG.ref=null):xG.ref=null;
var kL=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-attr"),children:["ackages.default"]}),lL=(0,$APP.Y)("span",{className:$APP.X.h(null,"hljs-string"),children:['"0.0.1"']}),OI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"code",props:{className:$APP.X.h(null,"lang-nix"),children:["p",kL," ",FK," pkgs.buildNpmPackage {\n  ",PK," ",FK," ",aL,";\n  ",OK," ",FK," build;\n  ",TK," ",FK," ",UK,";\n  ",RK," ",FK," ",lL,";\n  ",VK," ",FK," deps-hash;\n};\n"]},
key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(OI.ref=null):OI.ref=null;var PI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.X.h(null,"cr-highlighted"),children:[OI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(PI.ref=null):PI.ref=null;
var QI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"org-src-container"),children:[PI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(QI.ref=null):QI.ref=null;var RI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-text-2"),id:"text-package-results-as-a-npm-package",children:[NI,xG,QI]},key:null,_owner:null,_store:{validated:!0}};
$APP.Z?$APP.k(null)&&(RI.ref=null):RI.ref=null;var SI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-2"),id:"outline-container-package-results-as-a-npm-package",children:[MI,RI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(SI.ref=null):SI.ref=null;
var mL=(0,$APP.Y)("h2",{className:$APP.X.h(null,"cr-self-reference "),id:"tips",children:["Tips"]}),TI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#tips",children:[mL]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(TI.ref=null):TI.ref=null;
var qL=(0,$APP.Y)("a",{href:"https://github.com/imakira/espoir/blob/main/flake.nix",children:["imakira/espoir/blob/main/flake.nix"]}),UI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["Check ",qL," for a working example."]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(UI.ref=null):UI.ref=null;
var VI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"ul",props:{className:$APP.X.h(null,"org-ul"),children:[UI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(VI.ref=null):VI.ref=null;var WI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-text-2"),id:"text-tips",children:[VI]},key:null,_owner:null,_store:{validated:!0}};
$APP.Z?$APP.k(null)&&(WI.ref=null):WI.ref=null;var XI={$$typeof:$APP.Z?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.X.h(null,"outline-2"),id:"outline-container-tips",children:[TI,WI]},key:null,_owner:null,_store:{validated:!0}};$APP.Z?$APP.k(null)&&(XI.ref=null):XI.ref=null;wG.uix_component_QMARK_=!0;DG.uix_component_QMARK_=!0;export default DG;export const component=DG;
//# sourceMappingURL=orgx.build-a-clojurescript-application-running-on-node-using-nix.js.map
