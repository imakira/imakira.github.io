import { $APP, shadow$provide } from "./default.js";
import "./shared.js";
const shadow_esm_import = function(x) { return import(x) };
var GH=function(a){a=$APP.iM(a);$APP.Le.g(a);return $APP.MD($APP.OD,$APP.ID(kI,[],!1),[$APP.LD($APP.jp,[$APP.S],[$APP.MD($APP.OD,$APP.ID(nI,[],!1),["\n\n"])]),oI,rI,tI,uI,vI])},HH=function(a){a=$APP.iM(a);$APP.Le.g(a);return $APP.LD(GH,$APP.de($APP.Pj.v($APP.M([$APP.Hn([$APP.Tn,$APP.ao,$APP.eq,$APP.io,$APP.Xn,$APP.fq,$APP.Zn,$APP.gq,$APP.Wn,$APP.Rn,$APP.Sn,$APP.hq,$APP.fo,$APP.go,$APP.iq,$APP.Un],[!0,$APP.Fe,!1,"Build a ClojureScript Application Running on Node Using Nix",!0,"/home/void/Projects/cerulean/workspace/blogs/build-a-clojurescript-application-running-on-node-using-nix.org",
null,null,"To build a ClojureScript application, we need to pull dependencies from two package managers. That is, JavaScript packages from  npm  and Clojure packages ...","build-a-clojurescript-application-running-on-node-using-nix","Coding","en_US","2025-11-03T17:25:27+08:00",'\x3cp\x3e\nTo build a ClojureScript application, we need to pull dependencies from two package managers. That is, JavaScript packages from \x3ccode\x3enpm\x3c/code\x3e and Clojure packages from \x3ccode\x3edeps.edn\x3c/code\x3e. After pulling the dependencies, we can then let \x3ccode\x3eshadow-cljs\x3c/code\x3e compiles the ClojureScript files into a single javascript and make the result a npm package. In this post, we rely on \x3ccode\x3enixpkgs\x3c/code\x3e\'s builtin \x3ccode\x3efetchNpmDeps\x3c/code\x3e and \x3ccode\x3ebuildNpmPackage\x3c/code\x3e for the npm side, and \x3ca href\x3d"https://github.com/jlesquembre/clj-nix"\x3eclj-nix\x3c/a\x3e for the nix side.\n\x3c/p\x3e\n\n\x3cpre class\x3d"orgx" data-wrapper\x3d"use-comp" data-wrapper-data\x3d"note"\x3e\x3cul class\x3d"org-ul"\x3e\n\x3cli\x3e\x3cb\x3echangelog\x3c/b\x3e   Jan 17, 2026: use a new method to build the nix package, supports git repos, reduces output size.\x3c/li\x3e\n\x3c/ul\x3e\n\n\x3c/pre\x3e\n\x3cdiv id\x3d"outline-container-prerequisites" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#prerequisites"\x3e\x3ch2 id\x3d"prerequisites" class\x3d"cr-self-reference "\x3ePrerequisites\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-prerequisites"\x3e\n\x3cp\x3e\nI will skip the details that are not unique to Nix. The following contents assume we already have a working shadow-cljs project that can produce a node.js target when running \x3ccode\x3enpm run release\x3c/code\x3e. Which is basically:\n\x3c/p\x3e\n\n\x3cul class\x3d"org-ul"\x3e\n\x3cli\x3ea \x3ccode\x3e:node-script\x3c/code\x3e target in \x3ccode\x3eshadow-cljs.edn\x3c/code\x3e, with \x3ccode\x3e:main\x3c/code\x3e function specified\x3c/li\x3e\n\x3cli\x3ea \x3ccode\x3erelease\x3c/code\x3e script in package.json, most probably \x3ccode\x3eshadow-cljs release script\x3c/code\x3e\x3c/li\x3e\n\x3cli\x3ean entry script specified in \x3ccode\x3ebin\x3c/code\x3e in package.json.\x3c/li\x3e\n\x3c/ul\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-prefetch-and-generate-lock-file-for-dependencies" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#prefetch-and-generate-lock-file-for-dependencies"\x3e\x3ch2 id\x3d"prefetch-and-generate-lock-file-for-dependencies" class\x3d"cr-self-reference "\x3ePrefetch and generate lock file for dependencies\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-prefetch-and-generate-lock-file-for-dependencies"\x3e\n\x3cp\x3e\nDuring the \x3ci\x3ebuild\x3c/i\x3e phase of nix package, the process cannot perform any network request, as that will defeat the whole point of \x3ci\x3edeterminism\x3c/i\x3e. The common practice is to use a \x3ci\x3elock file\x3c/i\x3e. Which is essentially a recipe of all the necessary resources (and their checksums) for the building process. We can then prefetch all the resources into the nix store and tell the building process where to find the necessary resources during the actual building.\n\x3c/p\x3e\n\n\x3cp\x3e\nOn the npm side, we do it by running the following command. It will output a sha256 code, we save it for later.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-bash"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3enix run nixpkgs#prefetch-npm-deps package-lock.json\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nOn the Clojure side, we execute the following command. It will generate a \x3ccode\x3edeps-lock.json\x3c/code\x3e file. We will refer it in the \x3ccode\x3eflake.nix\x3c/code\x3e.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-bash"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3enix run github:jlesquembre/clj-nix#deps-lock\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-build-with-shadow-cljs-and-~mkcljlib~" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#build-with-shadow-cljs-and-~mkcljlib~"\x3e\x3ch2 id\x3d"build-with-shadow-cljs-and-~mkcljlib~" class\x3d"cr-self-reference "\x3eBuild with shadow-cljs and \x3ccode\x3emkCljLib\x3c/code\x3e\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-build-with-shadow-cljs-and-~mkcljlib~"\x3e\n\x3cp\x3e\nWe need to add \x3ccode\x3eclj-nix\x3c/code\x3e\'s overlays to our flake.nix to be able to use \x3ccode\x3emkCljLib\x3c/code\x3e.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3ep\x3cspan class\x3d"hljs-attr"\x3ekgs\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-built_in"\x3eimport\x3c/span\x3e nixpkgs {\n  \x3cspan class\x3d"hljs-keyword"\x3einherit\x3c/span\x3e system;\n  \x3cspan class\x3d"hljs-attr"\x3eoverlays\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e [\n    clj-nix.overlays.default\n  ];\n};\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nFirst, we create a \x3ccode\x3enode_modules\x3c/code\x3e derivative which we will use later.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3ed\x3cspan class\x3d"hljs-attr"\x3eeps-hash\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;deps-hash\x26quot;\x3c/span\x3e;\n\n\x3cspan class\x3d"hljs-attr"\x3enpm-deps\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e pkgs.buildNpmPackage(\x3cspan class\x3d"hljs-params"\x3efinalAttrs:\x3c/span\x3e {\n  \x3cspan class\x3d"hljs-attr"\x3esrc\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e self;\n  \x3cspan class\x3d"hljs-attr"\x3epname\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;package-npm-deps\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3eversion\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;0.0\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3edontNpmBuild\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-literal"\x3etrue\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3enpmDepsHash\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e deps-hash;\n  \x3cspan class\x3d"hljs-attr"\x3einstallPhase\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\'\'\n  mkdir $out\n  cp -r ./node_modules $out/node_modules\n  \'\'\x3c/span\x3e;\n});\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nWe will use \x3ccode\x3emkCljLib\x3c/code\x3e to setup Clojure dependencies for us, while we copy JavaScript dependencies from the earlier step manually.\n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3eb\x3cspan class\x3d"hljs-attr"\x3euild\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e pkgs.mkCljLib {\n  \x3cspan class\x3d"hljs-attr"\x3eprojectSrc\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e self;\n  \x3cspan class\x3d"hljs-attr"\x3ename\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;espoir\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3ebuildCommand\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;\n  # copy node_modules from earlier step to build directory\n  cp -r \x3cspan class\x3d"hljs-subst"\x3e${npm-deps}\x3c/span\x3e/node_modules ./node_modules\n  \x3cspan class\x3d"hljs-subst"\x3e${pkgs.nodejs}\x3c/span\x3e/bin/npm run release\n  \x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3einstallPhase\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\'\'\n  mkdir -p $out\n  cp -R * $out/\n  \'\'\x3c/span\x3e;\n};\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\n\x3cp\x3e\nIn the \x3ccode\x3ebuildCommand\x3c/code\x3e, we setup the JavaScript dependencies, and call \x3ccode\x3enpm run release\x3c/code\x3e which in turn calls \x3ccode\x3eshadow-cljs\x3c/code\x3e to build the project.\n\x3c/p\x3e\n\n\x3cp\x3e\nIn \x3ccode\x3einstallPhase\x3c/code\x3e, we override the install process provided by \x3ccode\x3emkCljLib\x3c/code\x3e. Instead, we simply use all the files in the build directory as output.\n\x3c/p\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-package-results-as-a-npm-package" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#package-results-as-a-npm-package"\x3e\x3ch2 id\x3d"package-results-as-a-npm-package" class\x3d"cr-self-reference "\x3ePackage results as a npm package\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-package-results-as-a-npm-package"\x3e\n\x3cp\x3e\nWe can directly feed output from the earlier example to \x3ccode\x3ebuilNpmPackage\x3c/code\x3e. Since we already build the package, we will set \x3ccode\x3edontNpmBuild \x3d true;\x3c/code\x3e.\n\x3c/p\x3e\n\n\x3cp\x3e\nThe install process provided by \x3ccode\x3ebuildNpmPackage\x3c/code\x3e will package necessary dependencies and generate an executable calling the entry script. \n\x3c/p\x3e\n\n\x3cdiv class\x3d"org-src-container"\x3e\n\x3cpre class\x3d"cr-highlighted"\x3e\x3ccode class\x3d"lang-nix"\x3e\x3chtml\x3e\x3chead\x3e\x3c/head\x3e\x3cbody\x3ep\x3cspan class\x3d"hljs-attr"\x3eackages.default\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e pkgs.buildNpmPackage {\n  \x3cspan class\x3d"hljs-attr"\x3epname\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;espoir\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3esrc\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e build;\n  \x3cspan class\x3d"hljs-attr"\x3edontNpmBuild\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-literal"\x3etrue\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3eversion\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e \x3cspan class\x3d"hljs-string"\x3e\x26quot;0.0.1\x26quot;\x3c/span\x3e;\n  \x3cspan class\x3d"hljs-attr"\x3enpmDepsHash\x3c/span\x3e \x3cspan class\x3d"hljs-operator"\x3e\x3d\x3c/span\x3e deps-hash;\n};\n\x3c/body\x3e\x3c/html\x3e\x3c/code\x3e\x3c/pre\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv id\x3d"outline-container-tips" class\x3d"outline-2"\x3e\n\x3ca href\x3d"#tips"\x3e\x3ch2 id\x3d"tips" class\x3d"cr-self-reference "\x3eTips\x3c/h2\x3e\x3c/a\x3e\n\x3cdiv class\x3d"outline-text-2" id\x3d"text-tips"\x3e\n\x3cul class\x3d"org-ul"\x3e\n\x3cli\x3eCheck \x3ca href\x3d"https://github.com/imakira/espoir/blob/main/flake.nix"\x3eimakira/espoir/blob/main/flake.nix\x3c/a\x3e for a working example.\x3c/li\x3e\n\x3c/ul\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n',
null,"2026-01-17T17:39:46+08:00"]),a]))),[])};var IH=(0,$APP.ud)("code",{children:["npm"]}),JH=(0,$APP.ud)("code",{children:["deps.edn"]}),KH=(0,$APP.ud)("code",{children:["shadow-cljs"]}),LH=(0,$APP.ud)("code",{children:["nixpkgs"]}),MH=(0,$APP.ud)("code",{children:["fetchNpmDeps"]}),NH=(0,$APP.ud)("code",{children:["buildNpmPackage"]}),OH=(0,$APP.ud)("a",{href:"https://github.com/jlesquembre/clj-nix",children:["clj-nix"]}),kI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nTo build a ClojureScript application, we need to pull dependencies from two package managers. That is, JavaScript packages from ",
IH," and Clojure packages from ",JH,". After pulling the dependencies, we can then let ",KH," compiles the ClojureScript files into a single javascript and make the result a npm package. In this post, we rely on ",LH,"'s builtin ",MH," and ",NH," for the npm side, and ",OH," for the nix side.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(kI.ref=null):kI.ref=null;
var PH=(0,$APP.ud)("b",{children:["changelog"]}),xI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:[PH,"   Jan 17, 2026: use a new method to build the nix package, supports git repos, reduces output size."]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(xI.ref=null):xI.ref=null;
var nI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"ul",props:{className:$APP.FD.h(null,"org-ul"),children:["\n",xI,"\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(nI.ref=null):nI.ref=null;
var RH=(0,$APP.ud)("h2",{className:$APP.FD.h(null,"cr-self-reference "),id:"prerequisites",children:["Prerequisites"]}),yI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#prerequisites",children:[RH]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(yI.ref=null):yI.ref=null;
var TH=(0,$APP.ud)("code",{children:["npm run release"]}),AI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nI will skip the details that are not unique to Nix. The following contents assume we already have a working shadow-cljs project that can produce a node.js target when running ",TH,". Which is basically:\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(AI.ref=null):AI.ref=null;
var VH=(0,$APP.ud)("code",{children:[":node-script"]}),WH=(0,$APP.ud)("code",{children:["shadow-cljs.edn"]}),XH=(0,$APP.ud)("code",{children:[":main"]}),GI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["a ",VH," target in ",WH,", with ",XH," function specified"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(GI.ref=null):GI.ref=null;
var ZH=(0,$APP.ud)("code",{children:["release"]}),$H=(0,$APP.ud)("code",{children:["shadow-cljs release script"]}),HI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["a ",ZH," script in package.json, most probably ",$H]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(HI.ref=null):HI.ref=null;
var bI=(0,$APP.ud)("code",{children:["bin"]}),II={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["an entry script specified in ",bI," in package.json."]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(II.ref=null):II.ref=null;var KI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"ul",props:{className:$APP.FD.h(null,"org-ul"),children:[GI,HI,II]},key:null,_owner:null,_store:{validated:!0}};
$APP.Y?$APP.t(null)&&(KI.ref=null):KI.ref=null;var ZI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-text-2"),id:"text-prerequisites",children:[AI,KI]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(ZI.ref=null):ZI.ref=null;
var oI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-2"),id:"outline-container-prerequisites",children:[yI,ZI]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(oI.ref=null):oI.ref=null;
var fI=(0,$APP.ud)("h2",{className:$APP.FD.h(null,"cr-self-reference "),id:"prefetch-and-generate-lock-file-for-dependencies",children:["Prefetch and generate lock file for dependencies"]}),$I={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#prefetch-and-generate-lock-file-for-dependencies",children:[fI]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&($I.ref=null):$I.ref=null;
var hI=(0,$APP.ud)("i",{children:["build"]}),iI=(0,$APP.ud)("i",{children:["determinism"]}),jI=(0,$APP.ud)("i",{children:["lock file"]}),aJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nDuring the ",hI," phase of nix package, the process cannot perform any network request, as that will defeat the whole point of ",iI,". The common practice is to use a ",jI,". Which is essentially a recipe of all the necessary resources (and their checksums) for the building process. We can then prefetch all the resources into the nix store and tell the building process where to find the necessary resources during the actual building.\n"]},
key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(aJ.ref=null):aJ.ref=null;
var lI=(0,$APP.ud)("p",{children:["\nOn the npm side, we do it by running the following command. It will output a sha256 code, we save it for later.\n"]}),mI=(0,$APP.ud)("code",{className:$APP.FD.h(null,"lang-bash"),children:["nix run nixpkgs#prefetch-npm-deps package-lock.json\n"]}),bJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.FD.h(null,"cr-highlighted"),children:[mI]},key:null,_owner:null,_store:{validated:!0}};
$APP.Y?$APP.t(null)&&(bJ.ref=null):bJ.ref=null;var jJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"org-src-container"),children:[bJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(jJ.ref=null):jJ.ref=null;
var pI=(0,$APP.ud)("code",{children:["deps-lock.json"]}),qI=(0,$APP.ud)("code",{children:["flake.nix"]}),lJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nOn the Clojure side, we execute the following command. It will generate a ",pI," file. We will refer it in the ",qI,".\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(lJ.ref=null):lJ.ref=null;
var sI=(0,$APP.ud)("code",{className:$APP.FD.h(null,"lang-bash"),children:["nix run github:jlesquembre/clj-nix#deps-lock\n"]}),mJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.FD.h(null,"cr-highlighted"),children:[sI]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(mJ.ref=null):mJ.ref=null;
var nJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"org-src-container"),children:[mJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(nJ.ref=null):nJ.ref=null;
var pJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-text-2"),id:"text-prefetch-and-generate-lock-file-for-dependencies",children:[aJ,lI,jJ,lJ,nJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(pJ.ref=null):pJ.ref=null;
var rI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-2"),id:"outline-container-prefetch-and-generate-lock-file-for-dependencies",children:[$I,pJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(rI.ref=null):rI.ref=null;
var wI=(0,$APP.ud)("code",{children:["mkCljLib"]}),rJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"h2",props:{className:$APP.FD.h(null,"cr-self-reference "),id:"build-with-shadow-cljs-and-~mkcljlib~",children:["Build with shadow-cljs and ",wI]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(rJ.ref=null):rJ.ref=null;
var sJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#build-with-shadow-cljs-and-~mkcljlib~",children:[rJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(sJ.ref=null):sJ.ref=null;
var zI=(0,$APP.ud)("code",{children:["clj-nix"]}),uJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nWe need to add ",zI,"'s overlays to our flake.nix to be able to use ",wI,".\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(uJ.ref=null):uJ.ref=null;
var BI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["kgs"]}),CI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-operator"),children:["\x3d"]}),DI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-built_in"),children:["import"]}),EI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-keyword"),children:["inherit"]}),FI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["overlays"]}),xJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),
type:"code",props:{className:$APP.FD.h(null,"lang-nix"),children:["p",BI," ",CI," ",DI," nixpkgs {\n  ",EI," system;\n  ",FI," ",CI," [\n    clj-nix.overlays.default\n  ];\n};\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(xJ.ref=null):xJ.ref=null;var yJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.FD.h(null,"cr-highlighted"),children:[xJ]},key:null,_owner:null,_store:{validated:!0}};
$APP.Y?$APP.t(null)&&(yJ.ref=null):yJ.ref=null;var BJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"org-src-container"),children:[yJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(BJ.ref=null):BJ.ref=null;
var JI=(0,$APP.ud)("code",{children:["node_modules"]}),CJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nFirst, we create a ",JI," derivative which we will use later.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(CJ.ref=null):CJ.ref=null;
var LI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["eps-hash"]}),MI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-string"),children:['"deps-hash"']}),NI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["npm-deps"]}),OI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-params"),children:["finalAttrs:"]}),PI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["src"]}),QI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["pname"]}),
RI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-string"),children:['"package-npm-deps"']}),SI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["version"]}),TI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-string"),children:['"0.0"']}),UI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["dontNpmBuild"]}),VI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-literal"),children:["true"]}),WI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["npmDepsHash"]}),
XI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["installPhase"]}),YI=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-string"),children:["''\n  mkdir $out\n  cp -r ./node_modules $out/node_modules\n  ''"]}),DJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"code",props:{className:$APP.FD.h(null,"lang-nix"),children:["d",LI," ",CI," ",MI,";\n\n",NI," ",CI," pkgs.buildNpmPackage(",OI," {\n  ",PI," ",CI," self;\n  ",QI," ",CI," ",RI,
";\n  ",SI," ",CI," ",TI,";\n  ",UI," ",CI," ",VI,";\n  ",WI," ",CI," deps-hash;\n  ",XI," ",CI," ",YI,";\n});\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(DJ.ref=null):DJ.ref=null;var EJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.FD.h(null,"cr-highlighted"),children:[DJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(EJ.ref=null):EJ.ref=null;
var GJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"org-src-container"),children:[EJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(GJ.ref=null):GJ.ref=null;
var IJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nWe will use ",wI," to setup Clojure dependencies for us, while we copy JavaScript dependencies from the earlier step manually.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(IJ.ref=null):IJ.ref=null;
var cJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["uild"]}),dJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["projectSrc"]}),eJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["name"]}),fJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-string"),children:['"espoir"']}),gJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["buildCommand"]}),hJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-subst"),children:["${npm-deps}"]}),
iJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-subst"),children:["${pkgs.nodejs}"]}),JJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"span",props:{className:$APP.FD.h(null,"hljs-string"),children:['"\n  # copy node_modules from earlier step to build directory\n  cp -r ',hJ,"/node_modules ./node_modules\n  ",iJ,'/bin/npm run release\n  "']},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(JJ.ref=null):JJ.ref=null;
var kJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-string"),children:["''\n  mkdir -p $out\n  cp -R * $out/\n  ''"]}),KJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"code",props:{className:$APP.FD.h(null,"lang-nix"),children:["b",cJ," ",CI," pkgs.mkCljLib {\n  ",dJ," ",CI," self;\n  ",eJ," ",CI," ",fJ,";\n  ",gJ," ",CI," ",JJ,";\n  ",XI," ",CI," ",kJ,";\n};\n"]},key:null,_owner:null,_store:{validated:!0}};
$APP.Y?$APP.t(null)&&(KJ.ref=null):KJ.ref=null;var OJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.FD.h(null,"cr-highlighted"),children:[KJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(OJ.ref=null):OJ.ref=null;var QJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"org-src-container"),children:[OJ]},key:null,_owner:null,_store:{validated:!0}};
$APP.Y?$APP.t(null)&&(QJ.ref=null):QJ.ref=null;var oJ=(0,$APP.ud)("code",{children:["buildCommand"]}),SJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nIn the ",oJ,", we setup the JavaScript dependencies, and call ",TH," which in turn calls ",KH," to build the project.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(SJ.ref=null):SJ.ref=null;
var qJ=(0,$APP.ud)("code",{children:["installPhase"]}),VJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nIn ",qJ,", we override the install process provided by ",wI,". Instead, we simply use all the files in the build directory as output.\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(VJ.ref=null):VJ.ref=null;
var XJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-text-2"),id:"text-build-with-shadow-cljs-and-~mkcljlib~",children:[uJ,BJ,CJ,GJ,IJ,QJ,SJ,VJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(XJ.ref=null):XJ.ref=null;
var tI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-2"),id:"outline-container-build-with-shadow-cljs-and-~mkcljlib~",children:[sJ,XJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(tI.ref=null):tI.ref=null;
var tJ=(0,$APP.ud)("h2",{className:$APP.FD.h(null,"cr-self-reference "),id:"package-results-as-a-npm-package",children:["Package results as a npm package"]}),YJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#package-results-as-a-npm-package",children:[tJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(YJ.ref=null):YJ.ref=null;
var vJ=(0,$APP.ud)("code",{children:["builNpmPackage"]}),wJ=(0,$APP.ud)("code",{children:["dontNpmBuild \x3d true;"]}),ZJ={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nWe can directly feed output from the earlier example to ",vJ,". Since we already build the package, we will set ",wJ,".\n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(ZJ.ref=null):ZJ.ref=null;
var $J={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"p",props:{children:["\nThe install process provided by ",NH," will package necessary dependencies and generate an executable calling the entry script. \n"]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&($J.ref=null):$J.ref=null;
var zJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-attr"),children:["ackages.default"]}),AJ=(0,$APP.ud)("span",{className:$APP.FD.h(null,"hljs-string"),children:['"0.0.1"']}),aK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"code",props:{className:$APP.FD.h(null,"lang-nix"),children:["p",zJ," ",CI," pkgs.buildNpmPackage {\n  ",QI," ",CI," ",fJ,";\n  ",PI," ",CI," build;\n  ",UI," ",CI," ",VI,";\n  ",SI," ",CI," ",AJ,";\n  ",WI," ",CI," deps-hash;\n};\n"]},
key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(aK.ref=null):aK.ref=null;var bK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"pre",props:{className:$APP.FD.h(null,"cr-highlighted"),children:[aK]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(bK.ref=null):bK.ref=null;
var dK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"org-src-container"),children:[bK]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(dK.ref=null):dK.ref=null;
var fK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-text-2"),id:"text-package-results-as-a-npm-package",children:[ZJ,$J,dK]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(fK.ref=null):fK.ref=null;
var uI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-2"),id:"outline-container-package-results-as-a-npm-package",children:[YJ,fK]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(uI.ref=null):uI.ref=null;
var FJ=(0,$APP.ud)("h2",{className:$APP.FD.h(null,"cr-self-reference "),id:"tips",children:["Tips"]}),iK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"a",props:{href:"#tips",children:[FJ]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(iK.ref=null):iK.ref=null;
var HJ=(0,$APP.ud)("a",{href:"https://github.com/imakira/espoir/blob/main/flake.nix",children:["imakira/espoir/blob/main/flake.nix"]}),jK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"li",props:{children:["Check ",HJ," for a working example."]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(jK.ref=null):jK.ref=null;
var kK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"ul",props:{className:$APP.FD.h(null,"org-ul"),children:[jK]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(kK.ref=null):kK.ref=null;var lK={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-text-2"),id:"text-tips",children:[kK]},key:null,_owner:null,_store:{validated:!0}};
$APP.Y?$APP.t(null)&&(lK.ref=null):lK.ref=null;var vI={$$typeof:$APP.Y?Symbol.for("react.transitional.element"):Symbol.for("react.element"),type:"div",props:{className:$APP.FD.h(null,"outline-2"),id:"outline-container-tips",children:[iK,lK]},key:null,_owner:null,_store:{validated:!0}};$APP.Y?$APP.t(null)&&(vI.ref=null):vI.ref=null;GH.uix_component_QMARK_=!0;HH.uix_component_QMARK_=!0;export default HH;export const component=HH;
//# sourceMappingURL=orgx.build-a-clojurescript-application-running-on-node-using-nix.js.map
