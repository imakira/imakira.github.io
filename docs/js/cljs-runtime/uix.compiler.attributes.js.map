{"version":3,"sources":["uix/compiler/attributes.cljs"],"mappings":"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","names":["uix.compiler.attributes/js-val?","x","goog/typeOf","uix.compiler.attributes/prop-name-cache","uix.compiler.attributes/custom-prop-name-cache","uix.compiler.attributes/cc-regexp","js/RegExp","uix.compiler.attributes/cc-fn","s","clojure.string/upper-case","uix.compiler.attributes/dash-to-camel","name-str","clojure.string/starts-with?","uix.compiler.attributes/keyword->string","cljs.core/Keyword","uix.compiler.attributes/cached-prop-name","k","temp__5827__auto__","k'","v","uix.compiler.attributes/cached-custom-prop-name","uix.compiler.attributes/convert-interop-prop-value","cljs.core._EQ_","cljs.core/vector?","a","uix.compiler.attributes/convert-prop-value-shallow","uix.compiler.attributes/kv-conv","o","uix.compiler.attributes/convert-prop-value","uix.compiler.attributes/kv-conv-shallow","uix.compiler.attributes/custom-kv-conv","rest__70885#","cljs.core/map?","cljs.core/reduce-kv","cljs.core/coll?","cljs.core/clj->js","cljs.core/ifn?","cljs.core.apply","uix.compiler.attributes/convert-custom-prop-value","rest__70886#","uix.compiler.attributes/class-names-coll","classes","cljs.core.reduce","c","uix.compiler.attributes/class-names","var_args","G__70900","args-arr__5901__auto__","len__5876__auto__","i__5877__auto__","argseq__5902__auto__","cljs.core/IndexedSeq","seq70897","G__70898","cljs.core/first","cljs.core/next","G__70899","self__5861__auto__","or__5142__auto__","cljs.core/array?","b","uix.compiler.attributes.class_names","rst","uix.compiler.attributes/re-tag","uix.compiler.attributes/parse-tag","tag","tag-str","cljs.core/name","and__5140__auto__","cljs.core/not","cljs.core/re-matches","cljs.core/re-find","js/Error","vec__70913","cljs.core.nth","id","class-name","clojure.string/replace","uix.compiler.attributes/set-id-class","props","id-class","props-class","cljs.core.get","props-class-name","props-className","class","class?","G__70926","cljs.core.assoc","cljs.core.dissoc","uix.compiler.attributes/convert-props","shallow?","uix.compiler.attributes/interpret-attrs","maybe-attrs","uix.compiler.attributes/interpret-props"],"sourcesContent":["(ns uix.compiler.attributes\n  (:require [clojure.string :as str]))\n\n(declare convert-prop-value)\n(declare convert-prop-value-shallow)\n\n(defn js-val? [x]\n  (not (identical? \"object\" (goog/typeOf x))))\n\n(def prop-name-cache\n  #js {:class \"className\"\n       :for \"htmlFor\"\n       :charset \"charSet\"\n       :class-id \"classID\"\n       :item-id \"itemID\"})\n\n(def custom-prop-name-cache #js {})\n\n(def ^:private cc-regexp (js/RegExp. \"-(\\\\w)\" \"g\"))\n\n(defn- cc-fn [s]\n  (str/upper-case (aget s 1)))\n\n(defn ^string dash-to-camel [^string name-str]\n  (if (or (str/starts-with? name-str \"aria-\")\n          (str/starts-with? name-str \"data-\")\n          (str/starts-with? name-str \"--\"))\n    name-str\n    (.replace name-str cc-regexp cc-fn)))\n\n(defn keyword->string [x]\n  (if (keyword? x)\n    (-name ^not-native x)\n    x))\n\n(defn cached-prop-name [k]\n  (if (keyword? k)\n    (let [name-str (-name ^not-native k)]\n      (if-some [k' (aget prop-name-cache name-str)]\n        k'\n        (let [v (dash-to-camel name-str)]\n          (aset prop-name-cache name-str v)\n          v)))\n    k))\n\n(defn cached-custom-prop-name [k]\n  (if (keyword? k)\n    (let [name-str (-name ^not-native k)]\n      (if-some [k' (aget custom-prop-name-cache name-str)]\n        k'\n        (let [v (dash-to-camel name-str)]\n          (aset custom-prop-name-cache name-str v)\n          v)))\n    k))\n\n(defn convert-interop-prop-value [k v]\n  (cond\n    (= k :style) (if (vector? v)\n                   (-reduce ^not-native v\n                            (fn [a v]\n                              (.push a (convert-prop-value-shallow v))\n                              a)\n                            #js [])\n                   (convert-prop-value-shallow v))\n    (keyword? v) (-name ^not-native v)\n    :else v))\n\n(defn kv-conv [o k v]\n  (unchecked-set o (cached-prop-name k) (convert-prop-value v))\n  o)\n\n(defn kv-conv-shallow [o k v]\n  (unchecked-set o (cached-prop-name k) (convert-interop-prop-value k v))\n  o)\n\n(defn custom-kv-conv [o k v]\n  (unchecked-set o (cached-custom-prop-name k) (convert-prop-value v))\n  o)\n\n(defn convert-prop-value [x]\n  (cond\n    (js-val? x) x\n    (keyword? x) (-name ^not-native x)\n    (map? x) (reduce-kv kv-conv #js {} x)\n    (coll? x) (clj->js x)\n    (ifn? x) #(apply x %&)\n    :else (clj->js x)))\n\n(defn convert-custom-prop-value [x]\n  (cond\n    (js-val? x) x\n    (keyword? x) (-name ^not-native x)\n    (map? x) (reduce-kv custom-kv-conv #js {} x)\n    (coll? x) (clj->js x)\n    (ifn? x) #(apply x %&)\n    :else (clj->js x)))\n\n(defn convert-prop-value-shallow [x]\n  (if (map? x)\n    (reduce-kv kv-conv-shallow #js {} x)\n    x))\n\n(declare class-names)\n\n(defn class-names-coll [classes]\n  (let [^js/Array classes (reduce (fn [^js/Array a c]\n                                    (when ^boolean c\n                                      (->> (if (keyword? c) (-name ^not-native c) (class-names c))\n                                           (.push a)))\n                                    a)\n                                  #js []\n                                  classes)]\n    (when (pos? (.-length classes))\n      (.join classes \" \"))))\n\n(defn ^string class-names\n  \"Merges a collection of class names into a string\"\n  ([a]\n   (cond\n     (or (array? a) (coll? a)) (class-names-coll a)\n     (keyword? a) (-name ^not-native a)\n     :else a))\n  ([a b]\n   (if ^boolean a\n     (if ^boolean b\n       (str (class-names a) \" \" (class-names b))\n       (class-names a))\n     (class-names b)))\n  ([a b & rst]\n   (reduce class-names (class-names a b) rst)))\n\n(def re-tag\n  \"HyperScript tag pattern :div :div#id.class etc.\"\n  #\"([^\\.#]*)(?:#([^\\.#]+))?(?:\\.([^#]+))?\")\n\n(defn parse-tag\n  \"Takes HyperScript tag (:div#id.class) and returns parsed tag, id and class fields,\n  and boolean indicating if tag name is a custom element (a custom DOM element that has hyphen in the name)\"\n  [tag]\n  (let [tag-str (name tag)]\n    (when (and (not (re-matches re-tag tag-str))\n               (re-find #\"[#\\.]\" tag-str))\n      ;; Throwing NPE here because shadow catches those to bring up error view in a browser\n      (throw (js/Error. (str \"Invalid tag name (found: \" tag-str \"). Make sure that the name matches the format and ordering is correct `:tag#id.class`\"))))\n    (let [[tag id class-name] (next (re-matches re-tag tag-str))\n          tag (if (= \"\" tag) \"div\" tag)\n          class-name (when-not (nil? class-name)\n                       (str/replace class-name #\"\\.\" \" \"))]\n      #js [tag id class-name (some? (re-find #\"-\" tag))])))\n\n(defn set-id-class\n  \"Takes attributes map and parsed tag, and returns attributes merged with class names and id\"\n  [props id-class]\n  (let [props-class (get props :class)\n        props-class-name (get props :class-name)\n        props-className (get props :className)\n        id (aget id-class 1)\n        class (aget id-class 2)\n        class? (or class props-class props-class-name props-className)]\n    (cond-> props\n            ;; Only use ID from tag keyword if no :id in props already\n      (and (some? id) (nil? (get props :id)))\n      (assoc :id id)\n\n              ;; Merge classes\n      class?\n      (-> (dissoc :class :class-name :className)\n          (assoc :class (class-names class props-class props-class-name props-className))))))\n\n(defn ^js convert-props\n  \"Converts `props` Clojure map into JS object suitable for\n  passing as `props` object into `React.createElement`\n\n  - `props` \u2014 Clojure map of props\n  - `id-class` \u2014 a triplet of parsed tag, id and class names\n  - `shallow?` \u2014 indicates whether `props` map should be converted shallowly or not\"\n  [props id-class ^boolean shallow?]\n  (let [props (set-id-class props id-class)]\n    (cond\n      ^boolean (aget id-class 3)\n      (convert-custom-prop-value props)\n\n      shallow?\n      (convert-prop-value-shallow props)\n\n      :else (convert-prop-value props))))\n\n(defn interpret-attrs\n  \"Returns a tuple of attributes and a child element\n\n  - [attrs] when `attrs` is actually a map of attributes\n  - [nil attrs] when `attrs` is not a map, thus a child element\"\n  [maybe-attrs id-class shallow?]\n  (if (map? maybe-attrs)\n    #js [(convert-props maybe-attrs id-class shallow?)]\n    #js [(convert-props {} id-class shallow?) maybe-attrs]))\n\n(defn interpret-props\n  \"Returns a tuple of component props and a child element\n\n  - [props] when `props` is actually a map of attributes\n  - [nil props] when `props` is not a map, thus a child element\"\n  [props]\n  (if (map? props)\n    #js [props]\n    #js [nil props]))\n"],"x_google_ignoreList":[0]}