import "./cljs_env.js";
import "./cljs.core.js";
import "./uix.core.js";
import "./net.coruscation.cerulean.utils.js";
import "./net.coruscation.cerulean.common.components.js";
goog.provide('orgx.about_dynamic_adding_to_classpath_in_clojure');
orgx.about_dynamic_adding_to_classpath_in_clojure._comp = (function orgx$about_dynamic_adding_to_classpath_in_clojure$_comp(props__41395__auto__){
var props62100 = uix.core.glue_args(props__41395__auto__);
var post_props = props62100;
var ___41394__auto__ = cljs.core.dissoc.cljs$core$IFn$_invoke$arity$1(props62100);
var f__41396__auto__ = (function (){

if(goog.DEBUG){
var temp__5825__auto___62149 = orgx.about_dynamic_adding_to_classpath_in_clojure._comp.fast_refresh_signature;
if(cljs.core.truth_(temp__5825__auto___62149)){
var f__41310__auto___62150 = temp__5825__auto___62149;
(f__41310__auto___62150.cljs$core$IFn$_invoke$arity$0 ? f__41310__auto___62150.cljs$core$IFn$_invoke$arity$0() : f__41310__auto___62150.call(null));
} else {
}
} else {
}

return uix.compiler.aot._GT_el(uix.compiler.aot.fragment,[null,uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nWell, I guess people will just inevitably get into the problem of ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["classpath"]),", one way or another. ",uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie"}], ...["The Classpath is a Lie"])," described the problem very well: ",uix.compiler.alpha.create_element_STAR_("i", ...[null], ...["classpath is a lie"]),". ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["classpath"]),", ",uix.compiler.alpha.create_element_STAR_("i", ...[null], ...["per se"]),", is a simple list separated by colons, however, the real work is done by the ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["Classloader"]),".\n"])],[uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nNevertheless, this isn't a post talking about ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["classpath"])," and ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"]),". There are already a lot of great articles talking about it (",uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"#links"}], ...["links"])," at the end of this post), and I can't claim I understand ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoaders"])," to the extent that I can confidently teach others about it either.\n"]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nThis is a blog about what I have found during the process of trying to add new directories to ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["classpath"])," and ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["require"])," Clojure files in them at runtime. ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"])," in Clojure is something very messy. The best strategy probably is to avoid the problem altogether. But still, if you really want to do it, I wish the following content can offer some help.\n"]),uix.compiler.aot._GT_el("div",[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-2"),'id':"outline-container-use-builtin-~clojure.core/add-classpath~"}],[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"#use-builtin-~clojure.core/add-classpath~"}], ...[uix.compiler.alpha.create_element_STAR_("h2", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-self-reference "),'id':"use-builtin-~clojure.core/add-classpath~"}], ...["Use Builtin ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["clojure.core/add-classpath"])])]),uix.compiler.aot._GT_el("div",[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-text-2"),'id':"text-use-builtin-~clojure.core/add-classpath~"}],[uix.compiler.alpha.create_element_STAR_("p", ...[null], ...[uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["Clojure"])," has a builtin ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"])," function. Although it has been deprecated, it works for simple use cases.\n"]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-src-container")}], ...[uix.compiler.alpha.create_element_STAR_("pre", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-highlighted")}], ...[uix.compiler.alpha.create_element_STAR_("code", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"lang-clojure")}], ...["(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["defn"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-title")}], ...["check-dynamic-load"])," []\n  (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [tmp-dir (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".toFile"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["Files/createTempDirectory"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"classpath-demo\""])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["into-array"])])," java.nio.file.attribute.FileAttribute [])))\n        tmp-clj (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["File/createTempFile"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"demo\""])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\".clj\""])," tmp-dir)\n        tmp-name (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["subs"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".getName"])," tmp-clj)\n                       ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-number")}], ...["0"]),"\n                       (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".lastIndexOf"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".getName"])," tmp-clj)\n                                     ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\".\""]),"))]\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; Add `tmp-dir` to `classpath` using builtin `add-classpath`."]),"\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["add-classpath"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".toURL"])," tmp-dir))\n\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; Put a Clojure file under the directory"]),"\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["spit"])," tmp-clj\n          (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["str"])])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"(ns \""])," tmp-name ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\") (def a 1)\""]),"))\n                                        ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";"]),"\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; `require` the Clojure file, and resolve the variable"]),"\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["assert"])])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["="])])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-number")}], ...["1"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["var-get"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["requiring-resolve"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["symbol"])])," tmp-name\n                                                     ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"a\""]),")))))\n\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; Update the Clojure file"]),"\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["spit"])," tmp-clj\n          (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["str"])])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"(ns \""])," tmp-name ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\") (def a 2)\""]),"))\n\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; Reload the Clojure file"]),"\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["require"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["symbol"])])," tmp-name)\n             ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-symbol")}], ...[":reload-all"]),")\n\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; We can read the new value"]),"\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["assert"])])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["="])])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-number")}], ...["2"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["var-get"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["requiring-resolve"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["symbol"])])," tmp-name\n                                                     ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"a\""]),")))))\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["println"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"success\""]),")))\n\n",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; success"]),"\n(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["check-dynamic-load"]),")\n"])])]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nIf we evaluate the above code in a REPL or in cider, it works and prints \"success\". As we can see from the code, we can ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["require"])," a Clojure file whose path determined at runtime, and reload it to get the updated value.\n"]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nHowever, there is a reason of it being deprecated. We can check its source code:\n"]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-src-container")}], ...[uix.compiler.alpha.create_element_STAR_("pre", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-highlighted")}], ...[uix.compiler.alpha.create_element_STAR_("code", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"lang-java")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...["// The method used by clojure.core/add-classpath"]),"\n",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["static"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["public"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["void"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-title function_")}], ...["addURL"]),uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-params")}], ...["(Object url)"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["throws"])," MalformedURLException{\n      ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-type")}], ...["URL"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-variable")}], ...["u"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-operator")}], ...["="])," (url ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["instanceof"])," String) ? toUrl((String) url) : (URL) url;\n      ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-type")}], ...["ClassLoader"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-variable")}], ...["ccl"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-operator")}], ...["="])," Thread.currentThread().getContextClassLoader();\n      ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["if"]),"(ccl ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["instanceof"])," DynamicClassLoader)\n              ((DynamicClassLoader)ccl).addURL(u);\n      ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["else"]),"\n              ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["throw"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["new"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-title class_")}], ...["IllegalAccessError"]),"(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"Context classloader is not a DynamicClassLoader\""]),");\n}\n"])])]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nIt checks if the current thread's ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ContextClassLoader"])," is a ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["DynamicClassLoader"]),". If so, it will call the ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["DynamicClassLoader"]),"'s ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["addURL"])," method.\nThat means, this method will fail if there's some code set the current ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ContextClassLoader"])," to something other than a ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["DynamicClassLoader"]),".\n"]),uix.compiler.alpha.component_element(net.coruscation.cerulean.common.components.note,[cljs.core.PersistentArrayMap.EMPTY],[uix.compiler.aot._GT_el(uix.compiler.aot.fragment,[null,uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nWe expect ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"])," continues to work in case because the convention of setting a new ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"])," is to set the current ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"])," as the parent of the newly created ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"]),". However, ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["clojure.core/add-classpath"])," only checks the current ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"]),", more on this in the section.\n"])],["\n\n"])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-src-container")}], ...[uix.compiler.alpha.create_element_STAR_("pre", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-highlighted")}], ...[uix.compiler.alpha.create_element_STAR_("code", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"lang-clojure")}], ...["(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [future\n      (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["future"])]),"\n        (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [cl (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".getContextClassLoader"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["Thread/currentThread"]),"))]\n          (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".setContextClassLoader"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["Thread/currentThread"]),")\n                                  (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["java.net.URLClassLoader."])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["into-array"])])," java.net.URL [])\n                                                            cl)))\n            (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["try"])])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["check-dynamic-load"]),")\n             (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["assert"])])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"unreachable\""]),")\n             (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["catch"])," Throwable t\n               (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["println"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"dynamic loading failed\""]),"))))]\n  ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; \"dynamic loading failed\""]),"\n  @future)\n"])])])])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-2"),'id':"outline-container-use-~add-classpath~-from-~pomegranate~"}], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"#use-~add-classpath~-from-~pomegranate~"}], ...[uix.compiler.alpha.create_element_STAR_("h2", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-self-reference "),'id':"use-~add-classpath~-from-~pomegranate~"}], ...["Use ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"])," from ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["pomegranate"])])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-text-2"),'id':"text-use-~add-classpath~-from-~pomegranate~"}], ...[uix.compiler.alpha.create_element_STAR_("p", ...[null], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"https://github.com/clj-commons/pomegranate"}], ...["pomegranate"])," provides a ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"])," that solves the problem described in the previous section.\n"]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nThe only thing we need to change is to replace ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["clojure.core/add-classpath"])," with ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["cemerick.pomegranate/add-classpath"]),".\n"]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-src-container")}], ...[uix.compiler.alpha.create_element_STAR_("pre", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-highlighted")}], ...[uix.compiler.alpha.create_element_STAR_("code", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"lang-clojure")}], ...["(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["ns"])])," demo\n  (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-symbol")}], ...[":require"]),"\n   [cemerick.pomegranate ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-symbol")}], ...[":as"])," pomegranate]))\n\n(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["defn"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-title")}], ...["check-dynamic-load-using-pomegranate"])," []\n  (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; ..."]),"\n        ]\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; same code as `check-dynamic-load`"]),"\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["pomegranate/add-classpath"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".toURL"])," tmp-dir))\n    ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; same code as `check-dynamic-load`"]),"\n    ))\n\n(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [future\n      (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["future"])]),"\n        (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [cl (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".getContextClassLoader"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["Thread/currentThread"]),"))]\n          (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".setContextClassLoader"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["Thread/currentThread"]),")\n                                  (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["java.net.URLClassLoader."])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["into-array"])])," java.net.URL [])\n                                                            cl)))\n        (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["check-dynamic-load-using-pomegranate"]),")\n        (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["print"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"success\""]),"))]\n  ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; success"]),"\n  @future)\n"])])]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nUnlike ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"])," from ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["clojure.core"]),", ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["pomegranate"]),"'s ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"])," try to find the ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"])," closest to the ",uix.compiler.alpha.create_element_STAR_("i", ...[null], ...["Primordial ClassLoader"])," that is compatible with ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"]),", and call the ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["addURL"])," method from it.\n"]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-src-container")}], ...[uix.compiler.alpha.create_element_STAR_("pre", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-highlighted")}], ...[uix.compiler.alpha.create_element_STAR_("code", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"lang-clojure")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; in `add-classpath` function in pomegranate.clj  "]),"\n(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [classloaders (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["classloader-hierarchy"]),")]\n      (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["if-let"])])," [cl (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["last"])])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["filter"])])," modifiable-classloader? classloaders))]\n        (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["add-classpath"])," jar-or-dir cl)\n        (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["throw"])])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["IllegalStateException."])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["str"])])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-string")}], ...["\"Could not find a suitable classloader to modify from \""]),"\n                                            (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["mapv"])])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["fn"])])," [^ClassLoader c]\n                                                    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["->"])])," c .getClass .getSimpleName))\n                                                  classloaders))))))\n"])])])])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-2"),'id':"outline-container-create-a-~dynamicclassloader~-when-there-isn't-one"}], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"#create-a-~dynamicclassloader~-when-there-isn't-one"}], ...[uix.compiler.alpha.create_element_STAR_("h2", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-self-reference "),'id':"create-a-~dynamicclassloader~-when-there-isn't-one"}], ...["Create a ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["DynamicClassLoader"])," When There isn't One"])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-text-2"),'id':"text-create-a-~dynamicclassloader~-when-there-isn't-one"}], ...[uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nIf you are running Clojure in REPL or with ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["nrepl"]),", the ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ContextClassLoader"])," of the current thread will certainly be ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["DynamicClassLoader"]),", set by one of those tools. However, when you run ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["clj"])," command in a non-interactive manner, or use a AOT-compiled jar file, this wouldn't be the case.\n"]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nThis problem is quite easy to solve, we just need to set the ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ContextClassLoader"])," to a ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["DynamicClassLoader"])," created by ourselves in the entrypoint of the program.\n"]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-src-container")}], ...[uix.compiler.alpha.create_element_STAR_("pre", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-highlighted")}], ...[uix.compiler.alpha.create_element_STAR_("code", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"lang-clojure")}], ...["(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-keyword")}], ...["defn"])," ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-title")}], ...["-main"])," [& args]\n  (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["let"])])," [cl (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".getContextClassLoader"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["Thread/currentThread"]),"))]\n    (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[".setContextClassLoader"])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["Thread/currentThread"]),") (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["clojure.lang.DynamicClassLoader."])," cl)))\n  ",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-comment")}], ...[";; other code..."]),"\n  )\n"])])])])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-2"),'id':"outline-container-when-using-~kaocha~"}], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"#when-using-~kaocha~"}], ...[uix.compiler.alpha.create_element_STAR_("h2", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-self-reference "),'id':"when-using-~kaocha~"}], ...["When Using ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["kaocha"])])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-text-2"),'id':"text-when-using-~kaocha~"}], ...[uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nSo far, so good. Except when you finish the code and try to test some code and run it under the ",uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"https://github.com/lambdaisland/kaocha"}], ...["kaocha"])," test runner. ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["kaocha"])," also did its own thing with ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["ClassLoader"])," and provides a ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"])," method. It breaks the previous method.\n"]),uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nBy detecting ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["kaocha"]),"'s presence and calling its ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["add-classpath"]),", alongside with the ",uix.compiler.alpha.create_element_STAR_("code", ...[null], ...["pomegranate"])," one solves the issue for me.\n"]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-src-container")}], ...[uix.compiler.alpha.create_element_STAR_("pre", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-highlighted")}], ...[uix.compiler.alpha.create_element_STAR_("code", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"lang-clojure")}], ...["(",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["when"])])," (",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...["find-ns"])," 'kaocha.classpath)\n  ((",uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-name")}], ...[uix.compiler.alpha.create_element_STAR_("span", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"hljs-built_in")}], ...["intern"])])," 'kaocha.classpath\n           'add-classpath)\n   new-path))\n"])])])])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-2"),'id':"outline-container-a-few-more-words"}], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"#a-few-more-words"}], ...[uix.compiler.alpha.create_element_STAR_("h2", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-self-reference "),'id':"a-few-more-words"}], ...["A Few More Words"])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-text-2"),'id':"text-a-few-more-words"}], ...[uix.compiler.alpha.create_element_STAR_("p", ...[null], ...["\nThis post is definitely not comprehensive, and there are still a lot things I currently do not understand. The method I have described works for me for now. If you want to understand more about this topic, I have listed a few links below.\n"])])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-2"),'id':"outline-container-links"}], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"#links"}], ...[uix.compiler.alpha.create_element_STAR_("h2", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"cr-self-reference "),'id':"links"}], ...["Links"])]),uix.compiler.alpha.create_element_STAR_("div", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"outline-text-2"),'id':"text-links"}], ...[uix.compiler.alpha.create_element_STAR_("ol", ...[{'className':uix.compiler.attributes.class_names.cljs$core$IFn$_invoke$arity$2(null,"org-ol")}], ...[uix.compiler.alpha.create_element_STAR_("li", ...[null], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"https://www.infoworld.com/article/2171026/find-a-way-out-of-the-classloader-maze.html"}], ...["Find a way out of the ClassLoader maze"])," (2003)"]),uix.compiler.alpha.create_element_STAR_("li", ...[null], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"https://danielsz.github.io/2021-05-12T13_24.html"}], ...["Once Upon a Class"])]),uix.compiler.alpha.create_element_STAR_("li", ...[null], ...[uix.compiler.alpha.create_element_STAR_("a", ...[{'href':"https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie"}], ...["The Classpath is a Lie"])])])])])]);
});
if(goog.DEBUG){
var _STAR_current_component_STAR__orig_val__62135 = uix.core._STAR_current_component_STAR_;
var _STAR_current_component_STAR__temp_val__62136 = orgx.about_dynamic_adding_to_classpath_in_clojure._comp;
(uix.core._STAR_current_component_STAR_ = _STAR_current_component_STAR__temp_val__62136);

try{if(((cljs.core.map_QMARK_(props62100)) || ((props62100 == null)))){
} else {
throw (new Error((""+"Assert failed: "+cljs.core.str.cljs$core$IFn$_invoke$arity$1((""+"UIx component expects a map of props, but instead got "+cljs.core.str.cljs$core$IFn$_invoke$arity$1(props62100)))+"\n"+"(clojure.core/or (clojure.core/map? props62100) (clojure.core/nil? props62100))")));
}

return f__41396__auto__();
}finally {(uix.core._STAR_current_component_STAR_ = _STAR_current_component_STAR__orig_val__62135);
}} else {
return f__41396__auto__();
}
});

(orgx.about_dynamic_adding_to_classpath_in_clojure._comp.uix_component_QMARK_ = true);

uix.core.set_display_name(orgx.about_dynamic_adding_to_classpath_in_clojure._comp,"orgx.about-dynamic-adding-to-classpath-in-clojure/_comp");

if(goog.DEBUG){
if((typeof globalThis !== 'undefined') && (typeof globalThis.uix !== 'undefined') && (typeof globalThis.uix.dev !== 'undefined')){
var sig__41319__auto___62176 = globalThis.uix.dev.signature_BANG_();
(sig__41319__auto___62176.cljs$core$IFn$_invoke$arity$4 ? sig__41319__auto___62176.cljs$core$IFn$_invoke$arity$4(orgx.about_dynamic_adding_to_classpath_in_clojure._comp,"",null,null) : sig__41319__auto___62176.call(null,orgx.about_dynamic_adding_to_classpath_in_clojure._comp,"",null,null));

globalThis.uix.dev.register_BANG_(orgx.about_dynamic_adding_to_classpath_in_clojure._comp,orgx.about_dynamic_adding_to_classpath_in_clojure._comp.displayName);

(orgx.about_dynamic_adding_to_classpath_in_clojure._comp.fast_refresh_signature = sig__41319__auto___62176);
} else {
}
} else {
}

orgx.about_dynamic_adding_to_classpath_in_clojure.component = (function orgx$about_dynamic_adding_to_classpath_in_clojure$component(props__41395__auto__){
var props62138 = uix.core.glue_args(props__41395__auto__);
var props = props62138;
var ___41394__auto__ = cljs.core.dissoc.cljs$core$IFn$_invoke$arity$1(props62138);
var f__41396__auto__ = (function (){

if(goog.DEBUG){
var temp__5825__auto___62178 = orgx.about_dynamic_adding_to_classpath_in_clojure.component.fast_refresh_signature;
if(cljs.core.truth_(temp__5825__auto___62178)){
var f__41310__auto___62179 = temp__5825__auto___62178;
(f__41310__auto___62179.cljs$core$IFn$_invoke$arity$0 ? f__41310__auto___62179.cljs$core$IFn$_invoke$arity$0() : f__41310__auto___62179.call(null));
} else {
}
} else {
}

return uix.compiler.alpha.component_element(orgx.about_dynamic_adding_to_classpath_in_clojure._comp,uix.compiler.attributes.interpret_props(cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword("blog","orgx","blog/orgx",-1430261758),new cljs.core.Keyword("blog","tags","blog/tags",1766286535),new cljs.core.Keyword("blog","unlisted","blog/unlisted",-268124729),new cljs.core.Keyword("blog","title","blog/title",629301577),new cljs.core.Keyword("blog","show-toc?","blog/show-toc?",-1011924183),new cljs.core.Keyword("blog","file-path","blog/file-path",-2012853524),new cljs.core.Keyword("blog","author","blog/author",2110519182),new cljs.core.Keyword("blog","email","blog/email",1419146704),new cljs.core.Keyword("blog","description","blog/description",-1430014670),new cljs.core.Keyword("blog","id","blog/id",-1385637198),new cljs.core.Keyword("blog","category","blog/category",-596578574),new cljs.core.Keyword("blog","language","blog/language",-1598263178),new cljs.core.Keyword("blog","published-date","blog/published-date",1156678198),new cljs.core.Keyword("blog","content","blog/content",12798170),new cljs.core.Keyword("blog","orgx-require","blog/orgx-require",-1673054916),new cljs.core.Keyword("blog","modified-date","blog/modified-date",-216271460)],[true,cljs.core.PersistentVector.EMPTY,false,"About Dynamic Adding to Classpath in Clojure",true,"/home/void/Projects/cerulean/workspace/blogs/class-path.org",null,null,"Well, I guess people will just inevitably get into the problem of  classpath , one way or another.  The Classpath is a Lie  described the problem very well...","about-dynamic-adding-to-classpath-in-clojure","Coding","en_US","2026-01-25T00:00:00+08:00","<p>\nWell, I guess people will just inevitably get into the problem of <code>classpath</code>, one way or another. <a href=\"https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie\">The Classpath is a Lie</a> described the problem very well: <i>classpath is a lie</i>. <code>classpath</code>, <i>per se</i>, is a simple list separated by colons, however, the real work is done by the <code>Classloader</code>.\n</p>\n\n<p>\nNevertheless, this isn't a post talking about <code>classpath</code> and <code>ClassLoader</code>. There are already a lot of great articles talking about it (<a href=\"#links\">links</a> at the end of this post), and I can't claim I understand <code>ClassLoaders</code> to the extent that I can confidently teach others about it either.\n</p>\n\n<p>\nThis is a blog about what I have found during the process of trying to add new directories to <code>classpath</code> and <code>require</code> Clojure files in them at runtime. <code>ClassLoader</code> in Clojure is something very messy. The best strategy probably is to avoid the problem altogether. But still, if you really want to do it, I wish the following content can offer some help.\n</p>\n<div id=\"outline-container-use-builtin-~clojure.core/add-classpath~\" class=\"outline-2\">\n<a href=\"#use-builtin-~clojure.core/add-classpath~\"><h2 id=\"use-builtin-~clojure.core/add-classpath~\" class=\"cr-self-reference \">Use Builtin <code>clojure.core/add-classpath</code></h2></a>\n<div class=\"outline-text-2\" id=\"text-use-builtin-~clojure.core/add-classpath~\">\n<p>\n<code>Clojure</code> has a builtin <code>add-classpath</code> function. Although it has been deprecated, it works for simple use cases.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-keyword\">defn</span> <span class=\"hljs-title\">check-dynamic-load</span> []\n  (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [tmp-dir (<span class=\"hljs-name\">.toFile</span> (<span class=\"hljs-name\">Files/createTempDirectory</span> <span class=\"hljs-string\">&quot;classpath-demo&quot;</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">into-array</span></span> java.nio.file.attribute.FileAttribute [])))\n        tmp-clj (<span class=\"hljs-name\">File/createTempFile</span> <span class=\"hljs-string\">&quot;demo&quot;</span> <span class=\"hljs-string\">&quot;.clj&quot;</span> tmp-dir)\n        tmp-name (<span class=\"hljs-name\">subs</span> (<span class=\"hljs-name\">.getName</span> tmp-clj)\n                       <span class=\"hljs-number\">0</span>\n                       (<span class=\"hljs-name\">.lastIndexOf</span> (<span class=\"hljs-name\">.getName</span> tmp-clj)\n                                     <span class=\"hljs-string\">&quot;.&quot;</span>))]\n    <span class=\"hljs-comment\">;; Add `tmp-dir` to `classpath` using builtin `add-classpath`.</span>\n    (<span class=\"hljs-name\">add-classpath</span> (<span class=\"hljs-name\">.toURL</span> tmp-dir))\n\n    <span class=\"hljs-comment\">;; Put a Clojure file under the directory</span>\n    (<span class=\"hljs-name\">spit</span> tmp-clj\n          (<span class=\"hljs-name\"><span class=\"hljs-built_in\">str</span></span> <span class=\"hljs-string\">&quot;(ns &quot;</span> tmp-name <span class=\"hljs-string\">&quot;) (def a 1)&quot;</span>))\n                                        <span class=\"hljs-comment\">;</span>\n    <span class=\"hljs-comment\">;; `require` the Clojure file, and resolve the variable</span>\n    (<span class=\"hljs-name\"><span class=\"hljs-built_in\">assert</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">=</span></span> <span class=\"hljs-number\">1</span> (<span class=\"hljs-name\">var-get</span> (<span class=\"hljs-name\">requiring-resolve</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">symbol</span></span> tmp-name\n                                                     <span class=\"hljs-string\">&quot;a&quot;</span>)))))\n\n    <span class=\"hljs-comment\">;; Update the Clojure file</span>\n    (<span class=\"hljs-name\">spit</span> tmp-clj\n          (<span class=\"hljs-name\"><span class=\"hljs-built_in\">str</span></span> <span class=\"hljs-string\">&quot;(ns &quot;</span> tmp-name <span class=\"hljs-string\">&quot;) (def a 2)&quot;</span>))\n\n    <span class=\"hljs-comment\">;; Reload the Clojure file</span>\n    (<span class=\"hljs-name\">require</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">symbol</span></span> tmp-name)\n             <span class=\"hljs-symbol\">:reload-all</span>)\n\n    <span class=\"hljs-comment\">;; We can read the new value</span>\n    (<span class=\"hljs-name\"><span class=\"hljs-built_in\">assert</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">=</span></span> <span class=\"hljs-number\">2</span> (<span class=\"hljs-name\">var-get</span> (<span class=\"hljs-name\">requiring-resolve</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">symbol</span></span> tmp-name\n                                                     <span class=\"hljs-string\">&quot;a&quot;</span>)))))\n    (<span class=\"hljs-name\">println</span> <span class=\"hljs-string\">&quot;success&quot;</span>)))\n\n<span class=\"hljs-comment\">;; success</span>\n(<span class=\"hljs-name\">check-dynamic-load</span>)\n</body></html></code></pre>\n</div>\n\n<p>\nIf we evaluate the above code in a REPL or in cider, it works and prints &quot;success&quot;. As we can see from the code, we can <code>require</code> a Clojure file whose path determined at runtime, and reload it to get the updated value.\n</p>\n\n<p>\nHowever, there is a reason of it being deprecated. We can check its source code:\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-java\"><html><head></head><body><span class=\"hljs-comment\">// The method used by clojure.core/add-classpath</span>\n<span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">addURL</span><span class=\"hljs-params\">(Object url)</span> <span class=\"hljs-keyword\">throws</span> MalformedURLException{\n      <span class=\"hljs-type\">URL</span> <span class=\"hljs-variable\">u</span> <span class=\"hljs-operator\">=</span> (url <span class=\"hljs-keyword\">instanceof</span> String) ? toUrl((String) url) : (URL) url;\n      <span class=\"hljs-type\">ClassLoader</span> <span class=\"hljs-variable\">ccl</span> <span class=\"hljs-operator\">=</span> Thread.currentThread().getContextClassLoader();\n      <span class=\"hljs-keyword\">if</span>(ccl <span class=\"hljs-keyword\">instanceof</span> DynamicClassLoader)\n              ((DynamicClassLoader)ccl).addURL(u);\n      <span class=\"hljs-keyword\">else</span>\n              <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">IllegalAccessError</span>(<span class=\"hljs-string\">&quot;Context classloader is not a DynamicClassLoader&quot;</span>);\n}\n</body></html></code></pre>\n</div>\n\n<p>\nIt checks if the current thread's <code>ContextClassLoader</code> is a <code>DynamicClassLoader</code>. If so, it will call the <code>DynamicClassLoader</code>'s <code>addURL</code> method.\nThat means, this method will fail if there's some code set the current <code>ContextClassLoader</code> to something other than a <code>DynamicClassLoader</code>.\n</p>\n\n<pre class=\"orgx\" data-wrapper=\"use-comp\" data-wrapper-data=\"note\"><p>\nWe expect <code>add-classpath</code> continues to work in case because the convention of setting a new <code>ClassLoader</code> is to set the current <code>ClassLoader</code> as the parent of the newly created <code>ClassLoader</code>. However, <code>clojure.core/add-classpath</code> only checks the current <code>ClassLoader</code>, more on this in the section.\n</p>\n\n</pre>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [future\n      (<span class=\"hljs-name\"><span class=\"hljs-built_in\">future</span></span>\n        (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [cl (<span class=\"hljs-name\">.getContextClassLoader</span> (<span class=\"hljs-name\">Thread/currentThread</span>))]\n          (<span class=\"hljs-name\">.setContextClassLoader</span> (<span class=\"hljs-name\">Thread/currentThread</span>)\n                                  (<span class=\"hljs-name\">java.net.URLClassLoader.</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">into-array</span></span> java.net.URL [])\n                                                            cl)))\n            (<span class=\"hljs-name\"><span class=\"hljs-built_in\">try</span></span> (<span class=\"hljs-name\">check-dynamic-load</span>)\n             (<span class=\"hljs-name\"><span class=\"hljs-built_in\">assert</span></span> <span class=\"hljs-string\">&quot;unreachable&quot;</span>)\n             (<span class=\"hljs-name\">catch</span> Throwable t\n               (<span class=\"hljs-name\">println</span> <span class=\"hljs-string\">&quot;dynamic loading failed&quot;</span>))))]\n  <span class=\"hljs-comment\">;; &quot;dynamic loading failed&quot;</span>\n  @future)\n</body></html></code></pre>\n</div>\n</div>\n</div>\n<div id=\"outline-container-use-~add-classpath~-from-~pomegranate~\" class=\"outline-2\">\n<a href=\"#use-~add-classpath~-from-~pomegranate~\"><h2 id=\"use-~add-classpath~-from-~pomegranate~\" class=\"cr-self-reference \">Use <code>add-classpath</code> from <code>pomegranate</code></h2></a>\n<div class=\"outline-text-2\" id=\"text-use-~add-classpath~-from-~pomegranate~\">\n<p>\n<a href=\"https://github.com/clj-commons/pomegranate\">pomegranate</a> provides a <code>add-classpath</code> that solves the problem described in the previous section.\n</p>\n\n<p>\nThe only thing we need to change is to replace <code>clojure.core/add-classpath</code> with <code>cemerick.pomegranate/add-classpath</code>.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-name\"><span class=\"hljs-built_in\">ns</span></span> demo\n  (<span class=\"hljs-symbol\">:require</span>\n   [cemerick.pomegranate <span class=\"hljs-symbol\">:as</span> pomegranate]))\n\n(<span class=\"hljs-keyword\">defn</span> <span class=\"hljs-title\">check-dynamic-load-using-pomegranate</span> []\n  (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [<span class=\"hljs-comment\">;; ...</span>\n        ]\n    <span class=\"hljs-comment\">;; same code as `check-dynamic-load`</span>\n    (<span class=\"hljs-name\">pomegranate/add-classpath</span> (<span class=\"hljs-name\">.toURL</span> tmp-dir))\n    <span class=\"hljs-comment\">;; same code as `check-dynamic-load`</span>\n    ))\n\n(<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [future\n      (<span class=\"hljs-name\"><span class=\"hljs-built_in\">future</span></span>\n        (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [cl (<span class=\"hljs-name\">.getContextClassLoader</span> (<span class=\"hljs-name\">Thread/currentThread</span>))]\n          (<span class=\"hljs-name\">.setContextClassLoader</span> (<span class=\"hljs-name\">Thread/currentThread</span>)\n                                  (<span class=\"hljs-name\">java.net.URLClassLoader.</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">into-array</span></span> java.net.URL [])\n                                                            cl)))\n        (<span class=\"hljs-name\">check-dynamic-load-using-pomegranate</span>)\n        (<span class=\"hljs-name\">print</span> <span class=\"hljs-string\">&quot;success&quot;</span>))]\n  <span class=\"hljs-comment\">;; success</span>\n  @future)\n</body></html></code></pre>\n</div>\n\n<p>\nUnlike <code>add-classpath</code> from <code>clojure.core</code>, <code>pomegranate</code>'s <code>add-classpath</code> try to find the <code>ClassLoader</code> closest to the <i>Primordial ClassLoader</i> that is compatible with <code>add-classpath</code>, and call the <code>addURL</code> method from it.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body><span class=\"hljs-comment\">;; in `add-classpath` function in pomegranate.clj  </span>\n(<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [classloaders (<span class=\"hljs-name\">classloader-hierarchy</span>)]\n      (<span class=\"hljs-name\"><span class=\"hljs-built_in\">if-let</span></span> [cl (<span class=\"hljs-name\"><span class=\"hljs-built_in\">last</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">filter</span></span> modifiable-classloader? classloaders))]\n        (<span class=\"hljs-name\">add-classpath</span> jar-or-dir cl)\n        (<span class=\"hljs-name\"><span class=\"hljs-built_in\">throw</span></span> (<span class=\"hljs-name\">IllegalStateException.</span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">str</span></span> <span class=\"hljs-string\">&quot;Could not find a suitable classloader to modify from &quot;</span>\n                                            (<span class=\"hljs-name\"><span class=\"hljs-built_in\">mapv</span></span> (<span class=\"hljs-name\"><span class=\"hljs-built_in\">fn</span></span> [^ClassLoader c]\n                                                    (<span class=\"hljs-name\"><span class=\"hljs-built_in\">-&gt;</span></span> c .getClass .getSimpleName))\n                                                  classloaders))))))\n</body></html></code></pre>\n</div>\n</div>\n</div>\n<div id=\"outline-container-create-a-~dynamicclassloader~-when-there-isn't-one\" class=\"outline-2\">\n<a href=\"#create-a-~dynamicclassloader~-when-there-isn't-one\"><h2 id=\"create-a-~dynamicclassloader~-when-there-isn't-one\" class=\"cr-self-reference \">Create a <code>DynamicClassLoader</code> When There isn't One</h2></a>\n<div class=\"outline-text-2\" id=\"text-create-a-~dynamicclassloader~-when-there-isn't-one\">\n<p>\nIf you are running Clojure in REPL or with <code>nrepl</code>, the <code>ContextClassLoader</code> of the current thread will certainly be <code>DynamicClassLoader</code>, set by one of those tools. However, when you run <code>clj</code> command in a non-interactive manner, or use a AOT-compiled jar file, this wouldn't be the case.\n</p>\n\n<p>\nThis problem is quite easy to solve, we just need to set the <code>ContextClassLoader</code> to a <code>DynamicClassLoader</code> created by ourselves in the entrypoint of the program.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-keyword\">defn</span> <span class=\"hljs-title\">-main</span> [&amp; args]\n  (<span class=\"hljs-name\"><span class=\"hljs-built_in\">let</span></span> [cl (<span class=\"hljs-name\">.getContextClassLoader</span> (<span class=\"hljs-name\">Thread/currentThread</span>))]\n    (<span class=\"hljs-name\">.setContextClassLoader</span> (<span class=\"hljs-name\">Thread/currentThread</span>) (<span class=\"hljs-name\">clojure.lang.DynamicClassLoader.</span> cl)))\n  <span class=\"hljs-comment\">;; other code...</span>\n  )\n</body></html></code></pre>\n</div>\n</div>\n</div>\n<div id=\"outline-container-when-using-~kaocha~\" class=\"outline-2\">\n<a href=\"#when-using-~kaocha~\"><h2 id=\"when-using-~kaocha~\" class=\"cr-self-reference \">When Using <code>kaocha</code></h2></a>\n<div class=\"outline-text-2\" id=\"text-when-using-~kaocha~\">\n<p>\nSo far, so good. Except when you finish the code and try to test some code and run it under the <a href=\"https://github.com/lambdaisland/kaocha\">kaocha</a> test runner. <code>kaocha</code> also did its own thing with <code>ClassLoader</code> and provides a <code>add-classpath</code> method. It breaks the previous method.\n</p>\n\n<p>\nBy detecting <code>kaocha</code>'s presence and calling its <code>add-classpath</code>, alongside with the <code>pomegranate</code> one solves the issue for me.\n</p>\n\n<div class=\"org-src-container\">\n<pre class=\"cr-highlighted\"><code class=\"lang-clojure\"><html><head></head><body>(<span class=\"hljs-name\"><span class=\"hljs-built_in\">when</span></span> (<span class=\"hljs-name\">find-ns</span> 'kaocha.classpath)\n  ((<span class=\"hljs-name\"><span class=\"hljs-built_in\">intern</span></span> 'kaocha.classpath\n           'add-classpath)\n   new-path))\n</body></html></code></pre>\n</div>\n</div>\n</div>\n<div id=\"outline-container-a-few-more-words\" class=\"outline-2\">\n<a href=\"#a-few-more-words\"><h2 id=\"a-few-more-words\" class=\"cr-self-reference \">A Few More Words</h2></a>\n<div class=\"outline-text-2\" id=\"text-a-few-more-words\">\n<p>\nThis post is definitely not comprehensive, and there are still a lot things I currently do not understand. The method I have described works for me for now. If you want to understand more about this topic, I have listed a few links below.\n</p>\n</div>\n</div>\n<div id=\"outline-container-links\" class=\"outline-2\">\n<a href=\"#links\"><h2 id=\"links\" class=\"cr-self-reference \">Links</h2></a>\n<div class=\"outline-text-2\" id=\"text-links\">\n<ol class=\"org-ol\">\n<li><a href=\"https://www.infoworld.com/article/2171026/find-a-way-out-of-the-classloader-maze.html\">Find a way out of the ClassLoader maze</a> (2003)</li>\n<li><a href=\"https://danielsz.github.io/2021-05-12T13_24.html\">Once Upon a Class</a></li>\n<li><a href=\"https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie\">The Classpath is a Lie</a></li>\n</ol>\n</div>\n</div>\n",null,"2026-01-25T20:43:45+08:00"]),props], 0))),[]);
});
if(goog.DEBUG){
var _STAR_current_component_STAR__orig_val__62141 = uix.core._STAR_current_component_STAR_;
var _STAR_current_component_STAR__temp_val__62142 = orgx.about_dynamic_adding_to_classpath_in_clojure.component;
(uix.core._STAR_current_component_STAR_ = _STAR_current_component_STAR__temp_val__62142);

try{if(((cljs.core.map_QMARK_(props62138)) || ((props62138 == null)))){
} else {
throw (new Error((""+"Assert failed: "+cljs.core.str.cljs$core$IFn$_invoke$arity$1((""+"UIx component expects a map of props, but instead got "+cljs.core.str.cljs$core$IFn$_invoke$arity$1(props62138)))+"\n"+"(clojure.core/or (clojure.core/map? props62138) (clojure.core/nil? props62138))")));
}

return f__41396__auto__();
}finally {(uix.core._STAR_current_component_STAR_ = _STAR_current_component_STAR__orig_val__62141);
}} else {
return f__41396__auto__();
}
});

(orgx.about_dynamic_adding_to_classpath_in_clojure.component.uix_component_QMARK_ = true);

uix.core.set_display_name(orgx.about_dynamic_adding_to_classpath_in_clojure.component,"orgx.about-dynamic-adding-to-classpath-in-clojure/component");

if(goog.DEBUG){
if((typeof globalThis !== 'undefined') && (typeof globalThis.uix !== 'undefined') && (typeof globalThis.uix.dev !== 'undefined')){
var sig__41319__auto___62180 = globalThis.uix.dev.signature_BANG_();
(sig__41319__auto___62180.cljs$core$IFn$_invoke$arity$4 ? sig__41319__auto___62180.cljs$core$IFn$_invoke$arity$4(orgx.about_dynamic_adding_to_classpath_in_clojure.component,"",null,null) : sig__41319__auto___62180.call(null,orgx.about_dynamic_adding_to_classpath_in_clojure.component,"",null,null));

globalThis.uix.dev.register_BANG_(orgx.about_dynamic_adding_to_classpath_in_clojure.component,orgx.about_dynamic_adding_to_classpath_in_clojure.component.displayName);

(orgx.about_dynamic_adding_to_classpath_in_clojure.component.fast_refresh_signature = sig__41319__auto___62180);
} else {
}
} else {
}


//# sourceMappingURL=orgx.about_dynamic_adding_to_classpath_in_clojure.js.map
